# 滲透測試方法論
```
資訊收集
目標識別
服務枚舉
漏洞映射與列舉
社交工程學
漏洞利用與攻擊
提升權限
存取維護
文檔報告
```

# 資訊收集INFORMATION GATHERING

資訊收集階段

- 在這個階段中，要盡可能地收集與測試目標有關的各類資訊。
- 這些資訊包括DNS資訊、IP位址、採用的技術以及具體配置、用戶名的組織單位、檔、程式碼、密碼重置信息、連絡人資訊等。
- 資訊收集階段收集到的每一條資訊都至關重要。
- 資訊收集的方法可歸為兩類：主動式資訊收集和被動式資訊收集。
- 主動式收集方法是通過直接發起與被測目標網路之間的互動來獲取相關資訊。例如，ICMP ping 或者 TCP 埠掃描就屬於主動式資訊收集手段。
- 被動資訊收集方法，則是通過協力廠商服務來獲取目標網路的相關資訊，例如使用穀歌搜尋引擎等。
- 這兩種收集方式並沒有優劣之分，每種方式都有各自的優點。
- 如果採用被動式掃描，您收集到的資訊相對較少，但是這種掃描卻不會被發現。
- 儘管主動掃描可獲取的資訊相對多一些，但是很多設備可能已經捕獲了您的掃描行為。
- 在滲透測試專案中，可能需要重複進行多次掃描才能獲取足夠充分的資訊。
- 也可以與滲透測試的顧客進行溝通，選取他們需要的資訊收集方式。

## 測試列表
- 通過公開網站收集目標域的有關資訊；
- 收集網域(DOMAIN)的註冊資訊；
- DNS 分析；
- 收集路由資訊；
- 利用搜尋引擎。

- 互聯網上搜集資訊的互聯網管道主要有：
  - 論壇；
  - 公告板；
  - 新聞群組；
  - 媒體文章；
  - 博客；
  - 社交網路；
  - 其他商業或非商業性的網站。

# 目標識別
- 任務 ==> 識別目標的網路狀態、作業系統和網路架構。
- 該階段工作旨在完整地展現目標網路裡各種聯網設備或技術的完整關係，以幫助測試人員在接下來的工作裡枚舉目標網路的各種服務。
- Kali Linux 提供的一系列先進的網路工具，可以輕鬆探測到聯網主機，識別這些主機運行的作業系統，並根據每個設備在網路系統中的不同角色對它們進行歸類。
- 這些工具通常採用了基於上層網路通訊協定的主動和被動的檢測技術。它們能夠通過不同的方式巧妙地利用各種協定獲取許多有用的資訊，比如作業系統指紋等。

# 服務枚舉
- 根據前面各個階段的成果，進一步找出目標系統中所有開放的埠。
- 一旦找到了所有開放的埠PORT，就可以通過這些埠來列出目標系統上運行的服務。

- 有很多掃描埠的技術，如全開（full-open）掃描、半開（half-open）掃描、隱蔽式（stealth）掃描等。
- 這些技術都可用來檢測埠的開放情況，甚至可以掃描處於防火牆或者入侵偵測系統保護下的主機。
- 主機上開放的埠都有相應的服務程式，對這些資訊進行深度分析之後，可進一步發掘目標網路基礎設施中可能存在的漏洞。
- 因此，這個階段為其後的測試工作打下了基礎，有助於測試人員繼而發現各種網路設備上可能會造成嚴重危害的安全性漏洞。
- Kali Linux收錄的部分自動化工具可以輔助審計人員完成這一階段的目標。

### [TCP/UDP埠列表](https://zh.wikipedia.org/wiki/TCP/UDP%E7%AB%AF%E5%8F%A3%E5%88%97%E8%A1%A8)
- [List of TCP and UDP port numbers](https://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers)
- [Service Name and Transport Protocol Port Number Registry](https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml)
- [Request for Comments: 6335](https://www.rfc-editor.org/rfc/rfc6335.html)
- 16 BITS port address ==> There are 65,535 port numbers, but not all are used every day.
- Restricted port numbers or well-known port numbers are reserved by prominent companies and range from 0 to 1023. 
- Apple QuickTime, Structured Query Language services and Gopher services use some of these restricted ports.
- Those who want to register a specific port number can choose from 1024 to 49151. 
- Software companies typically register these port numbers. 
- Dynamic or private ports ranging from 49152 to 65536 are available for anyone to use.





# 漏洞映射與列舉
- 根據已經發現的開放埠和服務程式，查找、分析目標系統中存在的漏洞。
- Kali Linux 系統中提供的一系列自動化的網路和應用漏洞評估工具可以擔任完成這個階段的任務。
- 人工（手動）完成這些任務未嘗不可，只是人工作業極為耗時，而且需要有關人員擁有專家級的知識。
- 但是，如果能夠將自動和手動這兩種不同的測試方法結合起來，稽核人員對目標系統的認知就會更為清晰、透徹，並能夠仔細地檢查任何已知和未知的漏洞。
- 否則，被遺漏的漏洞將會一直殘留在目標網路系統裡。

# 社交工程學
- 如果目標網路沒有直接的入口，欺騙的藝術將起到抛磚引玉的重要作用。
- 對目標群組織中的人員進行定向攻擊，很有可能説明我們找到滲透目標系統的入口。
- 誘使用戶運行會安裝後門的惡意程式，就可能為審計人員的滲透工作形成突破。
- 社會工程學滲透分為多種不同實現形式。
- 偽裝成網路系統管理員，通過電話要求使用者提供自己的帳戶資
- 發送釣魚郵件來劫持用戶的銀行帳戶
- 甚至是誘使某人出現在某個地點——這些都屬於社會工程學攻擊
- 在社會工程學中，達成同一既定目標的實現方式應有盡有。
- 需要注意的是，在對目標實施欺騙以達成滲透目標之前，多數情況下需要長時間研究目標人員的心理。
- 另外，在開展這個階段的工作之前，您需要事先研究法律是否有關於社會工程學的相關條款。



```
在仔細檢查和發現目標系統中的漏洞之後，就可以使用已有的漏洞利用程式對目標系統進行滲透。某些情況下不得不對漏洞利用程式（exploit）進行額外的研究和修改，否則它可能就無法正常工作。雖然這聽起來就很麻煩，但是先進的漏洞利用（修改）工具可使這項工作容易得多，而且Kali Linux 已經收錄了這種工具。此外，審計人員可以把用戶端漏洞利用程式和社會工程學進行結合，進而控制目標系統。這個階段的主要任務是控制目標系統。整個流程可以分為3步，涉及攻擊前、攻擊、攻擊後的相關行動。

2.5.8 提升許可權
獲取目標系統的控制權是滲透成功的標誌。接下來，審計人員就可以依據其所擁有的存取權限，在被測系統中自由發揮。審計人員也可以使用適用於目標系統的本地漏洞來提升自己的許可權。只要他們能夠在目標系統上運行提權漏洞利用程式，就可以獲得主機上的超級使用者許可權或者系統級許可權。審計人員還可以以該主機為跳板，進一步攻擊區域網路。根據之前對滲透範圍的界定，審計人員接下來會開展的攻擊可能是受限制的，也可能是不受限的。而後，他們很有可能以各種方式獲得與被控制系統有關的更多資訊。具體的說，他們可能使用嗅探手段截獲網路資料包，破解各種服務的密碼，在區域網路中使用網路欺騙手段。所以說，提升許可權的最終目的是獲得目標系統的最高存取權限。

2.5.9 訪問維護
多數情況下，審計人員需要在一段時間內維護他們對目標系統的存取權限。例如，在演示越權訪問目標系統的時候，安裝後門將節省重新滲透目標系統所耗費的大量時間。這些情況下，訪問維護將節約獲取目標系統存取權限所需要的時間、花費和資源。審計人員可以通過一些秘密的通信隧道，在既定時間內維持對目標的存取權限。這些隧道往往基於特定協定、代理或者點對點通信方法的後門程式。這種對系統的存取方法可以清楚地展示，入侵人員在目標系統實施攻擊時隱匿行蹤的具體方法。

2.5.10 文檔報告
在滲透測試的最後一個環節裡，審計人員要記錄、報告並現場演示那些已經識別、驗證和利用了的安全性漏洞。被測單位的管理和技術團隊會檢查滲透時使用的方法，並會根據這些文檔修補所有存在的安全性漏洞。所以從道德角度來看，文檔報告的工作十分重要。為了幫助慣例人員和技術人員共同理解、分析當前IT基礎架構中的薄弱環節，可能需要給不同的部門撰寫不同措辭的書面報告。此外，這些報告還可以用來獲取和比較滲透測試前後目標系統的完整性。

```
