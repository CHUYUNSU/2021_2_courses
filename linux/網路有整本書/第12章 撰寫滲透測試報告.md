#
```
第12章 撰寫滲透測試報告
專業的滲透測試要對評估結果進行追蹤，所以滲透測試也要有正規的記錄卷宗。把各種測試工具的輸入和輸出記錄進行文檔化管理，可保證評估結果的準確性、一致性和可再現性。滲透測試這個部分的工作，可能會涉及向客戶演示評估結果的工作。應當嚴肅對待這個環節的工作。某些客戶都會對已有漏洞進行緩解控制，然後模擬測試人員的測試過程，以驗證改進措施的有效性；另一些客戶可能會通過合同要求測試人員進行再次測試，以驗證客戶改進方案的效果。使用準確的語言把測試的各個步驟整理為有關卷宗，有助於您在這個環節中進行相同的驗證性測試。
測試的卷宗應當記錄下測試工作中的全部測試行為。在滲透測試的時間視窗內，萬一甲方的業務受到測試以外的因素的影響，這些卷宗將能證明您的測試內容。雖然記錄操作行為的這種事情乏味而枯燥，但是專業的滲透測試人員會非常注重這項工作。
要精心準備涉及核心領域的文檔、彙報和現場演示，注重內容的全域性、條理性和連貫性。本章會詳細介紹有關工作的要點，指導讀者通盤考慮文檔和報告工作的策略。本章將會涉及以下主題。
● 驗證測試結果，畢竟彙報的內容應當是經過驗證的測試結論。
● 滲透測試專案時常涉及客戶的行政層、管理層、技術層。不同層面的人員對測試專案有著不同的關注點。本文將討論分別滿足他們需求的報告類型和報告結構。
● 演示一節將介紹如何根據聽眾水準準備適當的演示材料。
● 滲透報告都要有測試的後期工作、改正方法和改進建議。這部分將説明有關部門進行整改。要提出專業的整改意見，就要從安全的角度深度分析被測單位的資訊系統，這無疑是彙報人員工作中的一大難點。
本章的各個小節均能指導讀者得當地準備文檔、彙報和演示工作。這些工作的細微紕漏都可能引發法律問題。報告的觀點必須與測試中發現的事實一致。而且，指出目標系統的潛在缺陷只是報告的基本作用，客戶對報告的期待往往更高。例如，客戶可能要求報告內容能夠以已知的和規劃規定為出發點，通過具有說服力的證據進行問題演示。此外，還要明確可用來進行攻擊的犯罪手段、有關工具和技術，列舉已發現的漏洞並驗證利用漏洞的可行性。大體上說，文檔報告的重點應當是甲方的安全脆弱性，而不是乙方挖掘漏洞的具體過程或涉及漏洞的技術現象。
12.1 文檔記錄與結果驗證
在測試過程中可能會發現很多漏洞，但是並非每個漏洞都可被利用。要驗證漏洞存在被攻擊的可能性，本質上說就必須對大量的漏洞進行驗證。驗證漏洞是減少出錯的必要手段，更是關係到信譽和誠實形象的重要工作。不少人都會直接整段複製掃描程式的掃描報告，把那些文字拼湊一下就直接向客戶交付。這種做法不僅不負責任，而且缺乏對評估過程的必要控制，最終可能導致嚴重的後果，甚至影響測試人員的職業生涯。如果軟體的掃描結果存在假陰性問題，會讓使用者錯誤地判斷安全水準，甚至令他們身陷危險。因此，必須儘量排除錯誤，消除測試結果之中的各種矛盾，力爭保證測試資料的完整性不受人為因素的影響。以下的這些工作方法，有助於測試人員進行文檔管理並驗證測試結果的有效性，從而説明他們把資料轉變為真正的最終報告。
● 詳細記錄資訊收集、目標識別、服務枚舉、漏洞映射、社會工程學、漏洞利用、提升權權和訪問維護各階段的具體工作步驟。
● 最好給每個將會用到的Kali 工具都草擬一份筆記範本。這種範本應當明確聲明工具用途、指令選項、與評估任務的關係，並空出留白以記錄相應的測試結果。在使用特定工具得出某項結論之前，要至少重複這些過程兩次，以避免測試結果受不可遇見因素的影響。例如，在使用Nmap程式進行埠掃描時，測試人員應當確定筆記範本中的內容涵蓋了所有必要的資訊，至少包括：使用目的、目標主機、指令選項、相關簡介（例如服務監測、作業系統類型、MAC 位址、開放埠、設備類型等內容），並記錄下相關程式的輸出結果。
● 不要僅憑單一工具的結果就草率地作出鑒定結論。過於依賴單一工具（例如資訊收集工具）的做法絕對不可取，因為那樣可能會給滲透測試工作帶來偏差甚至錯誤。所以，本書強烈建議您使用不同的工具進行相同項目的測試。這將確保測試結果的有效性，提高效率，減少假陰性和假陽性的偏差問題。換而言之，每個工具都是在特定環境下使用的具有各自專長的程式。某些實際情況下，測試人員可能要進行人工測試。總而言之，要充分利用個人知識和專案經驗驗證程式結果的有效性。
12.2 報告的種類
在驗證過測試結果的全部細節之後，測試人員要把這些資訊條理分明地組合成結構清晰的書面報告，最後還要把報告交付給利益相關者。測試報告可分為三種類型。每種類型的報告都有各自的模式，分別側重於被測單位的不同角色人員。這三種報告分別是：
● 行政報告；
● 管理報告；
● 技術報告。
滲透測試人員要根據閱讀人員的理解能力傳遞相應的資訊。本文將詳細介紹毎一種報告的行文結構和基本要素。然而，具體內容就需要測試人員根據專案目標自行斟酌了。需要注意的是，在向有關人員交付這些報告之前，應當確保這些報告向他們披露的資訊與保密協定、法律規定和滲透測試協議的要求一致。
12.2.1 行政報告
在各種評估報告中，行政報告屬於較為簡潔的報告。這種報告應當以企業高層的角度，從業務戰略的方面介紹滲透測試的作用。這種報告主要面對被測單位C開頭的高管（CEO、CTO、CIO等），所以必須具備下列基本要素。
● 專案目標：有滲透測試人員和被測單位共同協商制定的評定準則。
● 漏洞與其風險等級：這部分內容要描述漏洞的風險等級（關鍵級、高危級、中等風險、低等風險級和資訊洩露級）。風險的等級界定應能劃分並突出技術安全問題的嚴重程度。
● 執行摘要：簡明扼要地描述此次滲透測試任務採用的方法論、作用和目標，並著重介紹漏洞的數量以及可被利用的漏洞數量。
● 漏洞統計：分類介紹目標網路系統裡存在的漏洞。通常，測試人員還會以餅形圖或其他簡明易懂的方式進行演示。
● 風險矩陣：對以識別出的漏洞進行量化分析和分類總結，推斷可能會受風險影響的相關資源，以便於記憶的方式列舉出此次任務的發現、參考文獻和改進建議。
在草擬行政報告時，最好能夠兼顧報告內容的創造力和文字的表達能力。行政報告並不是以技術角度反映評估結果的技術細節，而是要對技術評估結果進行總結，指出它們對業務的實際影響。一般來說，行政報告的篇幅應當是2～4頁。
12.2.2 管理報告
管理報告通常討論安全問題相關的法律法規和合規性問題。這種報告通常是對行政報告的必要擴充，不僅應能滿足人力資源和其他管理層人士的工作需要，而且要從法定程式的角度分析問題。此類報告可能需要涉及以下方面。
● 法規問題：報告首先應當列舉出已知的各種安全標準和法律法規，並指出它們與當前安全問題涉及的有關法律條款。應當重點突出已經觸及的法律問題，以及企業可能在不經意間就會面臨的嚴重的法律風險。
● 測試方法：幫助管理層人士理解滲透測試生命週期的簡要介紹。
● 假設與局限性：闡述那些可能影響滲透測試人員完成特定目標的已知因素。
● 變更管理：某些人可能認為只有當被測單位進行系統改進的時候，測試人員才會涉及變更管理的工作。但是，在受控的 IT 環境中，策略管理和業務流程都涉及變更管理。測試人員在安全評估報告中提及的建議和推薦，應當與整個工作中地變化情況保持一致，以最大程度的減少意外事件給評估服務帶來的負面影響。
● 配置管理：側重於保持資訊系統功能和性能的一致性。以系統安全的角度來看，每當某個變更可能影響目標環境（硬體、軟體、物理屬性和其他問題）的時候，有關人員就應當隨後進行相應的配置管理。這種管理是對系統組態的一種監控手段，以維護系統的配置狀態。
一個負責的專業滲透測試人員，在滲透測試步入任何環節之前都會向管理團隊闡明情況。這種溝通工作不僅涉及一對一的面談，而且要明確界定特定測試的評估標準。即，測試人員要和被測單位探討評估時涉及合規化要求、評估採用的標準框架，確定特定測試的實際限制，判斷改進建議是否對目標系統切實可行，瞭解配置變更對當前系統狀態的影響等。所有這些因素都與目標環境的安全狀態有著千絲萬縷的聯繫，決定著技術安全評估人員應當給予什麼建議和意見。
12.2.3 技術報告
被評估單位主要參照技術報告解決滲透測試時發現的安全問題。這類報告主要面向技術人員，説明他們理解目標系統的核心安全問題。技術報告詳細介紹各種漏洞、利用漏洞的具體方法、安全問題給業務帶來的負面影響，以及針對這些威脅的補救建議。它得是全面保護網路系統的安全防護指南。前文介紹了行政報告和管理報告的基本要素。技術報告要對這兩種報告進行補充說明，滿足被評估單位技術團隊的各種需求。有些情況下，技術報告也要包含前兩種報告中的專案目標、漏洞及其風險等級、風險矩陣、漏洞統計、測試方法和假設與局限性內容。不過，技術報告的至少要涵蓋以下內容。
● 安全問題：技術報告應當詳細描述在滲透過程中發現的安全問題和針對這些漏洞的攻擊方法。它應該使用列表詳盡描述受影響的資源範圍、攻擊後果、測試時的請求和回應資料、類比攻擊所使用的請求和回應資料、向改善團隊提供外部的參考文獻、列舉出可説明被評估單位解決相關漏洞的針對性的專業建議。
● 漏洞映射：技術報告還應當詳細列舉出每個漏洞的具體位置，通過標識資訊的映射（即參照資訊）説明技術人員找到漏洞所在。例如，IP 位址和相應主機的對應關係就是一種標識資訊的映射。
● 利用程式映射：技術報告應當列舉出測試人員核對並驗證過的漏洞利用程式（exploit），並且要指明有關的漏洞利用程式是在網路裡可以找到的公開程式，還是不公開的自測程式。如果能夠指出漏洞利用程式的下載位址並說明它的公開日期，那麼這份報告就更有說服力。
● 最佳實踐：最佳實踐可指導有關人員改進在設計、實施和運營方面的安全機制。例如，大型企業的 IT 環境通常部署邊界級別的保護設施，以降低外部入侵的幾率。最佳實踐的各種案例都非常靈活，不需要干預生產系統也不需要改動原有程式。
一般來說，技術報告是向被測單位有關人員如實反映實際情況的技術文件。技術報告在風險管理中的作用重大，多數情況下都會被用於指導安全系統的改進工作。
12.3 滲透測試報告（樣文）
因為滲透測試各有不同，所以滲透測試報告的行文結構也靈活多變。本文提供了一份以網路為測試物件的滲透測試報告，讀者可以將其擴展為其他類型（如Web應用、防火牆、無線網路等）的滲透測試報告。滲透測試報告不僅有正文，肯定還有封面。應當在報告封面裡注明公司名稱、報告類型、掃描日期、作者姓名、文件修訂號、簡短的版權聲明和保密聲明。
以網路為測試目標的滲透測試報告，其正文部分應當由以下內容組成。
● 法律聲明（Legal notice）
● 滲透測試協議（Penetration testing agreement）
● 簡介（Introduction）
● 專案目標（Project objective）
● 假定和限制（Assumptions and imitations）
● 漏洞的影響（Vulnerability risk scale）
● 執行摘要（Executive summary）
● 風險矩陣（Risk matrix）
● 測試方法（Testing methodology）
● 安全威脅（Security threats）
● 改進建議（Recommendations）
● 漏洞映射（Vulnerabilities map）
● 利用方法（Exploits map）
● 合規性評估（Compliance assessment）
● 變更管理（Change management）
● 最佳實踐（Best Practices）
● 附錄（Annexes）
換而言之，報告撰寫人員要使用明確的行文結構，把各種類型的報告中的所有資訊整理為一份單獨的完整報告。報告中的這些章又可再度細化，分為各種節，以更為詳盡地介紹各種細節。例如，附錄章節可在不同小節裡分別列舉技術細節、分析測試過程、操作日誌、各種安全工具的原始資料、研究的詳情、網路資源的引用以及術語表。使用者會根據需要選擇他們要看的報告類型，而測試人員要根據這種需求判斷自己的定位和作用，然後再開始進行滲透測試。
12.4 準備演示的資料
在現場演示之前，演示人員應當實現瞭解聽眾的技術水準和關注要點。一次成功的現場演示，離不開針對聽眾的需求精心準備。若演講內容與聽眾需求脫節，演示活動將會招致聽眾的反感。現場演示主要為了讓聽眾理解測試人員在測試環節中發現的潛在風險因素。例如，行政級別的經理可能沒有心思關注社會工程學攻擊問題，但是他們可能需要理解安全的現狀，想指導採用什麼措施可以改善系統的安全性。
雖然在準備演示資料和演示方法方面沒有統一的正規流程，但是演講人員還是應當儘量讓聽眾中的技術人員和非技術人員都能有所收穫。估測聽眾的技能水準與瞭解被測資訊系統一樣，都是測試人員的工作。在現場演示中，要讓聽眾像瞭解他們的關鍵資產那樣瞭解演講人員的技術實力。
只有客觀地指出當前安全問題中存在的缺陷，才能保證現場演示不失專業水準。一次成功的現場演示應當以事實和現象為依據，由技術論證得出相應結論，並要給甲方負責改進的團隊提供相應的意見。演示是一種面對面的交流活動，演講人員應當事先準備好支援論點的事實和資料。
12.5 測試的後期流程
提供補救措施、改正步驟和整改建議都是滲透測試後期階段的工作。在這些工作裡，滲透測試人員要擔當被測單位的改進顧問。因為要和大量的技術人員打交道，所以此時溝通能力和網路技術能力就顯得尤為重要。
此外，除非專門進行培訓，否則目標人群不可能掌握被測單位IT系統的全部知識。這種條件下滲透測試人員的工作很難做，他們就需要與有關技術的專家配合，才能知道如何修補各個缺陷。本文提出幾個通用準則，以説明讀者向客戶提供關鍵的改進建議。
● 測試報告要從網路設計入手，並且指出可能利用漏洞的各種必備條件。
● 側重分析安全邊界或資料中心的保護方案，力圖在安全威脅後臺伺服器或工作站之前降低它們的數量。
● 用戶端攻擊和社會工程學攻擊幾乎無法避免。但是對員工進行針對性的最新對策和安全意識培訓，至少可以降低這些攻擊的危害。
● 滲透測試人員在提出每項建議之前，應當進行額外的調查，以確保他們的建議不會影響目標系統的功能。
● 在有必要部署協力廠商解決方案（IDS/IPS、防火牆、內容保護系統、殺毒軟體、IAM技術等）的時候，應當驗證這些方案的有效性和可靠性，還要對軟體運行機制進行安全和效率方面的優化。
● 要區別對待不安全的（或面向公共提供網路服務的）網域和安全的網域，實施分而治之的保護策略。
● 提高研發團隊的安全水準，通過安全的應用程式提高目標 IT 系統的安全性。應用程式的安全評估、原始程式碼審計都可以給整個企業帶來很高的回報。
● 採用物理安全措施。可通過安全環境設計、機械與電子門禁、入侵警報系統、閉路電視監控系統和個人身份識別系統，進行多層次的入場控制。
● 定期更新所有重要的安全系統，力求保證其保密性、完整性和可用性。
● 檢測並驗證所有檔中推薦的安全方案，消除入侵或漏洞利用的可能性。
12.6 本章總結
本章闡述了撰寫滲透測試報告所必需的基本步驟，討論了向客戶進行現場演示的核心環節。本章開頭便介紹了從某個工具中提取分析結果的具體方法，並強調了最終的彙報不能單純依賴單一工具的檢測結果。在最終定稿之前，測試人員必須使用自身經驗和有關知識驗證測試結果。也就是說，測試人員應當能人工驗證測試結果。本章還介紹了不同類型的報告格式，集中討論了從行政、管理和技術的方面撰寫安全審計報告的方法。此外，本文還提供了一份以網路為物件的滲透測試報告範本，讀者可在撰寫報告的時候參考我們的範本。接下來，本文闡述了現場演示的價值和驗證技術現象的方法，並介紹了向不同職業背景的聽眾進行演示的有關要點。
最後，本章還提供了在滲透測試後期通用的工作流程。讀者在向用戶提供有關補救措施或者改進建議的時候，可能需要參考這部分內容。這一節詳細闡述了測試人員以對方技術團隊顧問的身份，或者以改進負責人的身份向被測試單位提供整治意見的方法。


```
