##
```
第8章 社交工程攻擊
社交工程是利用人性弱點體察、獲取有價值資訊的實踐方法，它是一種欺騙的藝術。在缺少目標系統的必要資訊時，社交工程技術是滲透測試人員獲取資訊的至關重要的手段。對所有類型的組織（單位）而言，人都是安全防範措施裡最薄弱的一環，也是整個安全基礎設施最脆弱的層面。人都是社會的產物，人的本性就是社會性，所以人都有社會學方面的弱點都易受社交工程攻擊。社交工程的攻擊人員通常利用社交工程手段獲取機密資訊，甚至可以造訪受限區域。社交工程的方式多種多樣，而且每種方法的效果和導向完全取決於使用人員的想像能力。本章將闡述社交工程核心原則，並會介紹專業的社會工程攻擊人員用其操縱他人或挖掘資訊的實例。

本章分為以下幾個部分：

● 透過心理學的基本原理，帶領讀者大致瞭解社交工程的手段和目標。

● 通過幾個真實的例子，演示社交工程的攻擊過程及使用方法。

從安全角度來看，社交工程是以獲取特定資訊為目標的操縱他人的有力武器。很多單位都使用社交工程的方法進行安全評估，以考核雇員的安全完整性，並通過這種方法調查工作流程和人員方面的安全弱點。需要注意的是，社交工程是種很常見的技術，可以說各種人員都會使用這種技術。無論是滲透測試人員，還是詐騙專家、身份竊賊、商業合作夥伴、求職人員、銷售人員、資訊經紀人、電話推銷員、政府間諜、心懷不滿的員工，甚至日常生活中的孩童都會使用這種技術，只是他們的動機不同而已。

8.1 人類心理學建模
人類的心理取決於感官的輸入。感官的作用是形成對現實的感知。按照感官對自然現象的識別作用來劃分，人的感官可分成視覺、聽覺、味覺、觸覺、嗅覺、平衡和加速、溫度、動覺、疼痛感和方向感的感官。人類正是利用、發展他們的這些感官的功能，得以感知外部世界。站在社交工程的立場，任何通過顯性感覺（視覺或聽覺）、眼晴的動作（眼神接觸、口頭上的差異、眨眼頻率或眼睛暗示）、面部表情（驚喜、幸福、恐懼、悲傷、憤怒或厭惡）和其他抽象實體進行觀察或感覺收集到的資訊，都可增加成功獲取目標資訊的概率。大多數情況下，社交工程工程師必須直接與目標進行溝通，才能獲取機密資訊或受限區域的訪問權。溝通形式可以是直接見面的接觸方式，也可以是通過電子輔助技術進行的不見面接觸方式。在實際工作中，常見的溝通方式分為兩類：面談或問詢。但是，這兩種方法都受到其他因素的制約，例如環境因素、對目標的熟悉程度和控制溝通模式的能力。所有這些因素（溝通、環境、知識和溝通模式控制）構成社交工程工程師必備的基本技能。整個社交工程活動取決於攻擊者與目標之間的信任關係。如果不能與目標建立足夠的信任關係，則所有的努力都可能付之東流。

現在，社交工程已經形成了一門獨立學科。有關社交工程框架（Social Engineering Framework）的詳細資訊，請訪問作者的官方網站：http://www.social-engineer.org/。Christopher Hadnagy 運營著這個網站，並且發佈了社交工程領域的各種研究成果。他將這些資訊向公眾開放，以便於他人繼續研究社交工程攻擊的具體方法。如果需要對使用者進行安全培訓，可參考有關資料。

8.2 攻擊過程
本節將介紹一些發動社交工程攻擊的基本步驟。雖然這不是社交工程攻擊的唯一方法，甚至可以說沒有成功率高的正式方法，但是本文的這些步驟可説明您形成社交工程的基本認識。情報收集、識別漏洞、規劃攻擊和執行攻擊——社交工程工程師通常都會採用這些某本步驟，它們可有效獲取目標的有關資訊或存取權限。

1. 情報收集：多種技術都可用於找到最容易攻破的滲透測試目標。例如，我們可採用髙級搜索工具收集被測公司員工的E-mail地址；通過社交網路收集被測單位員工的個人資訊；識別被測單位組織使用的協力廠商套裝軟體；參與他們的經營活動、社交活動和參加其會議等。以這些方式提供的情報，能夠準確地推測出社交工程意義上的“線人”。

2. 識別漏洞：一旦選定了關鍵線人，接下來就開始與對方建立信任關係和友誼。這樣就可以在不傷害、不驚動目標的情況下，截獲被測單位的機密資訊。保持行動的隱蔽性和保密性，對於整個過程來說至關重要。另外，也可以調査被測單位是否使用了舊版本軟體，繼而通過惡意的E-mail或Web內容，利用軟體漏洞感染當事人的電腦。

3. 規劃攻擊：您可以對目標採取直截了當的攻擊方式，也可以利用電子輔助技術被動地攻擊目標。以這些挖掘出來的情報入口著手，我們可以輕鬆地擬定攻擊路徑和攻擊方法。例如，被測單位的客戶服務代表Bob和我們的關係很好，他還信任我們；他就可能在電腦上執行我們發送的E-mail附件，而這種攻擊不需要高級管理人員的任何事前授權。

4. 執行攻擊：社交工程攻擊的最後一步是執行攻擊計畫。此時，我們應該保持足夠的信心和耐心，主動監控和評估工作成果。完成這一步之後，社交工程工程師掌握了充分資訊，甚至可以訪問被測單位的內部系統，這些成果足以讓他們進一步地滲透被測單位。在成功執行攻擊計畫之後，社交工程的攻擊就可宣告結束。

8.3 攻擊方法
社交工程中，有5種有助於理解、識別、結交、準備目標的攻擊方法。社交工程按照它們的特點，將它們進行了歸類。本節介紹了一些真實的案例，以幫助讀者在實際情況中靈活運用各種所需方法。請注意這些攻擊方法針對的是個人的心理學因素，要想提高這些方法的效用，就應該進行定期的訓練和練習。

8.3.1 冒名頂替
攻擊人員常常假裝成他人以獲取對方的信任。例如，在獲取目標人員的銀行資訊方面，只要目標人員使用 E-mail，我們就可以進行釣魚攻擊。這種攻擊屬於近乎完美的攻擊方案。當決定使用釣魚攻擊之後，攻擊人員要大量地收集目標人員用過的 E-mail 位址，然後偽造出與原銀行介面一樣的網頁介面，以誘騙目標人員。

完成了以上準備之後，攻擊人員會草擬並發送一份正式行文的E-mail（例如，銀行帳戶更新通知）。這些E-mail看上去就像真正銀行發出來的郵件，要求目標人員訪問某網址更新帳戶資訊。不過，郵件提到的網址將把目標人員提交的資訊轉發給攻擊人員。攻擊人員事先掌握了特定的 Web 技術，他們使用多種先進的工具（例如 SSLstrip）就可以通過自動化手段輕鬆有效地達成預定任務。與那些借助他人幫助的欺騙方法相比，這種方法通過模擬銀行業務的手段可直接達成冒名頂替的目的。

8.3.2 投桃報李
通過利益交換的方式達成雙方各自利益的行為，被稱為投桃報李。這類攻擊需要長期業務合作達成的非正式（私人）關係。利用公司之間的信任關係，可以輕鬆地找到可獲取特定資訊的目標人員。例如Bob是一個專業駭客，他想知道ABC公司辦公大樓的物理安全性原則。進行仔細考察之後，他決定製作一個廉價銷售古玩的網站，以吸引兩名雇員的關注。Bob 可事先通過社交網站掌握這兩人的個人資訊，瞭解他們的 E-mail 位址、網路論壇等資料。在這兩人之中，Alice在Bob的網站上定期採購商品，成為了Bob的主要目標。Bob決定要以一件稀有古董換取她們公司的內部文件。利用人類心理學因素，他將向Alice發送了E-mail，以轉讓這件稀有古董為籌碼，要求Alice提供ABC公司的物理安全性原則。在混淆了工作責任和個人利益的狀態下，Alice把公司資訊透露給了Bob。在創建騙局的同時，通過價值交換的事情強化私人關係，可成為社交工程攻擊的有效手段。

8.3.3 狐假虎威
冒充目標單位業務負責人的身份從而干預正常業務的做法就是狐假虎威。有些人認為，這種攻擊方法屬於冒名頂替的一種特例。人們會出於本能下意識地接受權威和髙級管理人員的指示，這個時候他們會無視自己否定性的直覺。這種天性使我們容易在特定的威脅面前毫無抵抗力。例如，某人要通過XYZ公司的網路系統管理員獲取網路認證的技術細節。經過一段時間的專注分析，他可以通過利益交換方法獲得網路系統管理員和CEO的電話號碼。後來，他使用來電號碼的偽造服務（例如，www.spoofcard.com）給網路系統管理員打電話。此時，網管會認為該電話來自CEO，將遵從攻擊人員的指示。這種假冒權威人員身份的狐假虎威的做法，利用了目標人員必須遵從公司高級管理人員指示的規律，誘導目標人員洩露資訊。

8.4 啖以重利
人們常說“機不可失”，他們特別關注所謂機不可失的寶貴機會。這些想法都是人性貪婪一面的寫照。啖以重利的方法利用了人們渴求謀利機會的貪婪心理。著名的 Nigerian 419 Scam（www.419eater.com）是利用人類貪欲的典型例子。讓我們舉一個例子，Bob想要收集XYZ大學裡學生的個人資訊。在他獲取所有學生的E-mail位址的情況下，他可以向學生們發送郵件並宣告：提供個人資訊（姓名、位址、電話、電子郵件、出生日期、護照號碼等）將免費獲贈 iPod。由於這個創意專門針對在校學生設計，而且足以使他們確信能夠免費獲得最新的 iPod，所以多數的在校學生會落入這個騙局。在企業界，相應的攻擊方法通常鼓吹可以獲得最大商業收益，達成業務目標。

8.5 社會關係
作為人，我們需要某種形式的社會關係，以分享思想、感情和想法。社會關係最易受攻擊的部分是“性”。多數情況下，異性總是互相吸引。由於這種強烈的感情和信任的錯覺，人們可能在不意間向對手透露資訊。很多線上的社交門戶網站都提供了見面和聊天的服務，以促進使用者間的社會交際。Facebook、MySpace、Twitter、Orkut 等網站都是如此。例如， XYZ公司聘請了Bob，要他獲取ABC公司財務策略和市場行銷戰略以保持自身的競爭優勢。他首先査找對方公司的雇員資訊，發現 ABC 公司負責所有業務運營的人是一個叫作 Alice的女孩。因此，他假裝是一個普通的工商學的研究生，試圖與Alice取得聯繫（例如，通過Facebook）。後來，Bob 蓄意營造遇見 Alice 的機會，共同出席聚會、年慶活動，一同造訪舞廳、音樂廳等地方。通過在見面期間的攀談，Bob自然而然地獲取到ABC公司有用的財務和市場策略資訊。請記住，達成的關係越有效，越信任，就越有利於社交工程工程師達到目標。在資訊安全方面還有很多簡化這些操作的工具。下一小節將會介紹的SET工具就是典型的社交工程工具。

8.6 Social Engineering Toolkit（SET）
Social Engineering Toolkit（SET）是一款先進的多功能的社交工程電腦輔助工具集。它由 TrustedSec（https://www.trustedsec.com）的創始人編寫，可以行之有效地利用用戶端應用程式的漏洞獲取目標的機息（例如E-mail密碼）。SET可實現多種非常有效且實用的攻擊方法。其中，人們常用的方法有：用惡意附件對目標進行E-mail釣魚攻擊、Java applet 攻擊、基於流覽器的漏洞攻擊、收集網站認證資訊、建立感染的便攜媒體（USB/DVD/CD）、郵件群發攻擊及其他類似攻擊。它是實現這些攻擊方法的合成攻擊平臺。充分利用這個程式的極具說服力的技術，可對人的因素進行深入測試。

如需啟動SET，可在桌面功能表中依次選中Applications | Kali Linux | Exploitation Tools | Social Engineering Toolkit | setoolkit。

或者在終端中載入SET程式。

[email protected]:～# setoolkit

上述指令將顯示如下選項（見圖8.1）。

本例將演示通過惡意PDF附件發起釣魚攻擊的方法。在收件人打開附件時，他們的主機將被攻陷。

不要使用SET工具集自帶的更新功能更新SET套裝程式。您應該使用Kali Linux 系統的更新功能，以獲取SET 軟體的更新。

figure_0229_0098

圖8.1

定向釣魚攻擊
如果採用這種攻擊方法，我們就要首先創建一個配合惡意PDF附件的E-mail範本，再選擇適當的PDF exploit payload，然後設置攻擊平臺與目標主機之間的連接關係，最後通過Gmail向目標發送這封E-mail。需要注意的是，您可以通過Kali Linux自帶的sendmail程式偽造原始寄件者的 E-mail 地址和 IP 地址。Sendmail 的設定檔是/usr/share/set/config/set_config。有關程式的詳細資訊，請參考Social Engineer Toolkit（SET）的官方說明：http://www.social-engineer.org/framework/Social_Engineering_Framework。

這種攻擊方法的具體步驟如下。

1. 在SET 程式的最初功能表裡選擇1，進入圖8.2 所示的設置介面。

2. 我們選擇1，即Spear-fishing Attack Vectors，然後進入圖8.3 所示的設置介面。

3. 在上述選項中，我們必須選擇 3，創建社交工程郵件的範本。然後，我們書寫郵件正文，如圖8.4所示。

figure_0230_0099

圖8.2

figure_0230_0100

圖8.3

figure_0230_0101

圖8.4

4. 雖然我們在上一步裡寫好了郵件的正文，但是並沒有設置郵件的格式。範本生成程式會把您編輯的內容當作範本的一部分套用格式範本。在編輯完正文之後，使用Ctrl+C鍵返回上級功能表。然後，進行E-mail攻擊的有關設置。我們從Perform a Mass Email Attack功能表裡選擇1，再選擇6，即Adobe CoolType SING Table“uniqueName”Overflow選項，如圖8.5所示。

figure_0231_0102

圖8.5

5. 接下來設置payload 類型。本例應該選擇6，即Windows reverse TCP shell。然後設置目標主機應當連接到的攻擊平臺（通常是Kali Linux 主機）的IP 和埠。本例假設攻擊平臺的IP位址是192.168.1.1，服務埠是5555。我們進行相應設置，如圖8.6所示。

6. 然後我們更改檔案名，以使檔案名稱引人注目。我們把 payload 的檔案名改成了BizRep2010.pdf。然後，我們要讓SET知道它要如何處理我們的payload。我們選擇 1，向單個 E-mail 位址發送 payload；然後再選擇 1，使用先前編輯好的郵件範本。現在，您的螢幕大體會是圖8.7所示的這種情況。

figure_0232_0103

圖8.6

figure_0232_0104

圖8.7

7. 接下來，我們選擇先前創建的 E-mail 範本（11）。這樣，SET 將在後續的社交工程攻擊裡重複利用這個範本。您創建的範本的品質，很大程度上決定了釣魚戰役的實際效果。然後，我們使用有效的E-mail中轉伺服器或Gmail帳戶向目標人員發送攻擊性E-mail。

只有在測試條款裡存在相應測試內容且客戶明確理解測試內容的情況下，您才可以進行這種攻擊測試。SET工具把感染檔發送給E-mail收件人，這種行為可能會引發法律問題。您需要參照發起測試地區的當地法律檔瞭解有關的法律規定。一旦您在SET中設置了E-mail資訊，它就會立即建立連接發送文件。程式會在沒有任何警告或提示的情況下直接發送E-mail。

8. 至此，我們已經向目標發起了攻擊。現在我們等待受害人打開我們的惡意PDF 檔。在他/她打開PDF附件的時候，我們將通過反射shell連接到被害人電腦的shell。請注意，我們配置的 IP 位址 192.168.1.1 是攻擊人員主機的 IP 位址（也就是Steven電腦的IP），它在5555埠受理被害人電腦反射shell返回的連接。

通過上述步驟，我們就完成了向目標發起社交工程攻擊的操作，並可遠端存取被害人的主機。我們可在shell的互動式提示符下執行Windows命令。

SET 可同時對一人或多人進行電子郵件的釣魚攻擊。它整合了可定制的 E-mail 功能，便於社交工程工程師制定安全的攻擊路線。這種功能可在攻擊多個公司員工的同時保持攻擊的隱蔽性。

SET 的作者不斷地更新著這個程式，以適應當前技術的劇烈變化。不過，它的功能可見一斑。本書強烈建議讀者訪問作者的網站，繼續領略 SET 的風采。它的官方網站是https://www.trustedsec.com/downloads/social- engineer-toolkit/。

8.7 本章總結
在本章中，我們闡述了社交工程在生活中各領域的常見用法。滲透測試人員可以根據實際情況採取相應的社交工程策略，獲取目標的敏感資訊。人性本身非常容易受到這種技術的欺騙攻擊。為了全面介紹社交工程的技巧，本文討論了構成人類心理學模型的幾個因素，這些因素包括溝通、環境、知識和溝通模式控制。這些心理學原則可説明攻擊人員根據被測目標的實際情況，擬定適用的攻擊過程（情報收集、確定漏洞點、規劃攻擊和執行攻擊）和攻擊方法（冒名頂替、投桃報李、狐假虎威、啖以重利和社會關係）。隨後，我們演示了 SET 的使用方法，它具有線上進行自動化社交工程攻擊的強大功能。

```
