#
```
第2章 滲透測試方法論
滲透測試（penetration testing，pentest）是實施安全評估（即審計）的具體手段。方法論是在制定、實施資訊安全審計方案時，需要遵循的規則、慣例和過程。人們在評估網路、應用、系統或三者組合的安全狀況時，不斷摸索各種務實的理念和成熟的做法，並總結出了一套理論——測試方法論。本章簡要介紹了滲透測試方法論的各關鍵要點，涉及的主題包括：
● 兩種廣為認知的滲透測試類型——黑盒測試和白盒測試；
● 漏洞評估和滲透測試的區別；
● 業界普遍採納的安全測試方法論，以及其核心功能、特徵和優勢；
● 典型的滲透測試所涉及的10 個階段；
● 安全測試的道德準則。
滲透測試可能是單獨進行的一項工作，也可能是常規研發生命週期（例如，Microsoft SDLC）裡 IT 安全風險管理的一個組成部分。產品的安全性並不完全取決於 IT 方面的技術因素，還會受到與該產品有關的最佳安全實踐的影響。具體而言，增強產品安全性的工作涉及安全需求分析、風險分析、威脅建模、代碼審查和運營安全。
通常認為，滲透測試是安全評估最終的也是最具侵犯性的形式，它必須由符合資質的專業人士實施。在進行評估之前，有關人員可能瞭解也可能不瞭解目標的具體情況。滲透測試可用於評估所有的IT基礎設施，包括應用程式、網路設備、作業系統、通信設備、物理安全和人類心理學。滲透測試的工作成果就是一份滲透測試報告。這種報告分為多個部分闡述在當前的目標系統裡找到的安全弱點，並且會討論可行的對抗措施和其他改進建議。充分應用滲透測試方法論，有助於測試人員在滲透測試的各個階段深入理解並透徹分析當前存在的防禦措施。
2.1 滲透測試的種類
雖然滲透測試各種各樣，但是業內普遍將其劃分為兩類：白盒測試和黑盒測試。
2.1.1 黑盒測試
在進行黑盒測試時，安全審計員在不清楚被被測單位的內部技術構造的情況下，從外部評估網路基礎設施的安全性。在滲透測試的各個階段，黑盒測試借助真實世界的駭客技術，暴露出目標的安全問題，甚至可以揭露尚未被他人利用的安全弱點。滲透測試人員應能理解安全弱點，將之分類並按照風險級別（高、中、低）對其排序。通常來說，風險級別取決於相關弱點可能形成的危害的大小。老練的滲透測試專家應能確定可引發安全事故的所有攻擊模式。當測試人員完成黑盒測試的所有測試工作之後，他們會把與測試物件安全狀況有關的必要資訊進行整理，並使用業務的語言描述這些被識別出來的風險，繼而將之匯總為書面報告。黑盒測試的市場報價通常會高於白盒測試。
2.1.2 白盒測試
白盒測試的審計員可以獲取被測單位的各種內部資料甚至不公開資料，所以滲透測試人員的視野更為開闊。若以白盒測試的方法評估安全性漏洞，測試人員可以以最小的工作量達到最高的評估精確度。白盒測試從被測系統環境自身出發，全面消除內部安全問題，從而增加了從單位外部滲透系統的難度。黑盒測試起不到這樣的作用。白盒測試所需的步驟數目與黑盒測試不相上下。另外，若能將白盒測試與常規的研發生命週期相結合，就可以在入侵者發現甚至利用安全弱點之前，盡可能最早地消除全部安全隱患。這使得白盒測試的時間、成本，以及發現、解決安全弱點的技術門檻都全面低於黑盒測試。
2.2 脆弱性評估與滲透測試
正確地理解和使用安全評估領域的技術術語十分必要。在您的職業生涯中，您可能時常會遇到那些不瞭解行業術語，卻需要從這些專用名詞裡選一個進行採購的人。其實商業公司和非商業機構裡大有這樣的人在。至少您應該明白這些類型的測試各是什麼。
脆弱性評估通過分析企業資產面臨威脅的情況和程度，評估內部和外部的安全控制的安全性。這種技術上的資訊系統評估，不僅要揭露現有防範措施裡存在的風險，而且要提出多重備選的補救策略，並將這些策略進行比較。內部的脆弱性評估可保證內部系統的安全性，而外部的脆弱性評估則用於驗證邊界防護（perimeter defenses）的有效性。無論進行內部脆弱性評估還是進行外部脆弱性評估，評估人員都會採用各種攻擊模式嚴格測試網路資產的安全性，從而驗證資訊系統處理安全威脅的能力，進而確定應對措施的有效性。不同類型的脆弱性評估需要的測試流程、測試工具和自動化測試技術也不相同。這可以通過一體化的安全弱點管控（vulnerability management）平臺來實現。現在的安全弱點管控平臺帶有可自動更新的漏洞資料庫，能夠測試不同類型的網路設備，而且不會影響配置管理和變更管理的完整性。
脆弱性評估和滲透測試兩者最大的區別就是：滲透測試不僅要識別目標的弱點，它還涉及在目標系統上進行漏洞利用、許可權提升和訪問維護。換句話說，脆弱性評估雖然可以充分發現系統裡的缺陷，但是不會考慮去衡量這些缺陷對系統造成的危害。另外，相比脆弱性評估，滲透測試更傾向於入侵，會刻意使用各種技術手段利用安全性漏洞；所以滲透測試可能對生產環境帶來實際的破壞性影響。而脆弱性評估則是以非入侵性的方式，定性、定量地識別已知安全弱點。
為何需要滲透測試？
如果不能確定防火牆、IDS、檔完整性監控等風險減緩控制的實際效果，那麼就應當進行滲透測試。雖然漏洞掃描（脆弱性評估）能夠發現各個漏洞，但是滲透測試則會驗證這些漏洞在實際環境裡被利用的可能性。
有些觀點認為，這兩種類型的安全評估重複性很高，只是同義詞而已。這種觀點絕對有誤。合格的安全顧問會根據客戶的商務需求，選擇一種最合適的安全評估向顧客推薦，絕對不會把不同類型的安全評估混為一談。然而，仔細核實安全評估專案的內容和做出最終決定確實是顧客的責任。
滲透測試的價格比脆弱性評估的價格要高。
2.3 安全測試方法論
為滿足安全評估的相應需求，人們已經總結出了多種開源方法論。無論被評估目標的規模有多大，複雜性有多高，只要應用這些安全評估的方法論，就可以策略性地完成各種時間要求苛刻、富有挑戰性的安全評估任務。某些方法論專注于安全測試的技術方面，有些則關注管理領域。只有極少數的方法論能夠同時兼顧技術因素和管理因素。在評估工作中實踐這些方法論，基本上都是按部就班地執行各種測試，以精確地判斷被測試系統的安全狀況。
本書再次向您推薦幾種著名的安全評估方法論。本章將重點突出這些方法論的關鍵特徵和優勢，希望它們能夠説明您拓寬網路安全和應用安全評估的視野。
● 開源安全測試方法論
● 資訊系統安全評估框架
● 開放式Web 應用安全項目
● Web 應用安全聯合威脅分類
● 滲透測試執行標準
上述這些測試框架和方法論，都能夠指導安全人士針對客戶需求制定最得當的策略。其中，前兩個方法論所提供的通用原則和方法，幾乎可以指導面向任何類型資產的安全測試。由OWASP（Open Web Application Security Project）推出的測試框架主要面向應用安全的安全評估。PTES（Penetration Testing Execution Standard）能夠指導所有類型的滲透測試工作。然而需要注意的是，安全狀態本身是一個持續變化的過程，而滲透測試只能夠獲取目標系統在被測試的那一時刻的安全狀態。在測試的過程中，哪怕被測的資訊系統發生了細微的變化，都可能影響安全測試的全域工作，從而導致最終的測試結果不正確。此外，單一的測試方法論並不一定能夠涵蓋風險評估工作的所有方面。而擬定適合目標網路和應用環境的最佳測試策略，確實是安全審計人員的職責。
安全測試的方法論有很多。要選取最佳的指導理論，就需要綜合考慮成本和效果的因素。所以，評估策略的篩選工作受到多種因素的制約。這些因素包括與目標系統有關的技術細節和各種資源、滲透人員的知識結構、業務目標以及法規問題。以業務的角度看，效果和成本控制至關重要。本文介紹的這幾種方法論，在官方網站上都有非常正規的詳細說明文件。在此，我們對它們進行簡要總結。如需瞭解詳細的工作流程，您需要親自訪問相關網站，仔細研究各種檔和實施細則。
2.3.1 開源安全測試方法論（OSSTMM）
開源安全測試方法論（Open Source Security Testing Methodology Manual，OSSTMM）（官方網站是http://www.isecom.org/research/osstmm.html）是由Pete Herzog 創建，繼而由ISECOM發展的測試方法論。它是國際公認的安全測試和安全分析標準。很多企業正在他們的日常評估工作中應用這一標準。以技術的角度看，這一方法論把安全評估工作劃分為 4 組：範圍（scope）、通道（channel）、索引（index）和向量（vector）。“範圍”指代評估人員收集被測單位全部資產相關資訊的工作。“通道”則是這些資產之間的通信方式和互動類型；包括物理方式、光學方式和其他方式的通信。每個通道都構成了一套獨特的安全性群組件，都要在評估階段進行測試和驗證。這些元件包括物理安全、人類心理學、資料網路、無線通訊介質和電信設施。所謂“索引”，泛指特定資產和相應ID的對應關係。例如，審計人員常常要明確MAC位址和IP位址的對應關係，就是為了整理一種索引。而“向量”指的是審計人員訪問和分析功能性資產的方式。以上幾個部分，組成了全面評估被測IT運營環境的整個技術流程，被稱為審計範疇（audit scope）。
OSSTMM的方法論總結了多種形式的安全測試，並將它們劃分為6個標準種類。
● 盲測（blind）：事先不瞭解目標系統的任何情況的測試就是盲測。然而，在評估過程開始之前，被測單位會知道何時開始安全測試。道德駭客（Ethical hacking）和對抗競賽（War Gaming）就是典型的盲測。因為盲測遵循了道德規範，事先通知被測單位，所以這種測試方法也被廣泛接受。
● 雙盲測試（double blind）：在雙盲測試中，審計人員事先不清楚目標系統的情況，被測單位事先也不會知道將有安全測試。黑盒審計和滲透測試都屬於雙盲測試。當前絕大多數的安全審計採用雙盲測試方法。對於審計人員來說，選擇能夠勝任的最佳工具和最佳技術已經是一種考驗了。
● 灰盒測試（grey box）：在灰盒測試中，審計師僅瞭解被測系統有限的情況，被測單位也會知道審計開始和結束的時間。脆弱性評估就屬於灰盒測試。
● 雙灰盒測試（double grey box）：雙灰盒測試工作的方式類似於灰盒測試。只不過在雙灰盒測試中，會給審計人員定義一個時限，而且這種測試不涉及通道測試和滲透向量。白盒審計就屬於雙灰盒測試。
● 串聯測試（tandem）：在串聯測試中，審計人員對目標系統只有最低限度的瞭解，而在測試開始前他們會通告被測單位。需要注意的是，串聯測試會測試得比較徹底。水晶盒測試和內部審計都是串聯測試的例子。
● 逆向測試（reversal）：在逆向測試中，審計員充分瞭解目標系統；而被測單位將永遠不會知道測試的時間或方式。
OSSTMM推廣的技術評估框架十分靈活。即使某個專案在邏輯上可分為3個連續的通道和5個安全性群組件，我們照樣可以使用OSSTMM的框架評估其安全性。OSSTMM體系的測試方法，通過檢查存取控制安全、流程安全、資料控制、物理位置、周界防護、安全意識水準、信任關係、反欺詐控制等諸多過程，全面評估被測單位的安全性。總體而言，這一理論強調測試目標和測試方法，注重在測試前、測試中、測試後應當採用的相應策略，而且介紹瞭解讀和綜合分析測試結果的方法。確切掌握目標系統當前的防護水準至關重要，有關資料十分珍貴。OSSTMM 引入了RAV（Risk Assessment Value，風險評估值）的概念，並通過它闡述了這一理論的很多理念。RAV 的基本功能是分析測試結果，進而基於三個因素（運營安全、損耗控制、局限程度）的標稱值來計算安全的標稱值。最後求得的這個標稱值稱為 RAV 得分。在引入 RAV 得分的概念之後，審計人員可以量化評估當前的安全狀態，並可為企業安全的下一步目標設定里程碑。從商業的角度來看，RAV 有助於優化安全投資，並可助您選擇更為有效的安全解決方案。
主要特性與優勢
OSSTMM的主要特性與優勢如下。
● OSSTMM 的方法可從本質上降低假陰性和假陽性的發生率。它推出的測量方法具有普遍的應用價值。
● 該架構適用於多種類型的安全測試，可用於滲透測試、白盒測試審計、漏洞評估等其他測試。
● 它能夠確保每次評估應進行得全面徹底，還能保證評估過程的一致性、可測性、可靠性。
● 該方法本身可分為4個相對獨立的階段，即定義階段、資訊階段、調節階段和控制測試階段。每一個階段都會獲取、評估和驗證目標環境中的相關資訊。
● RAV 的計算方法綜合衡量了運營安全、損耗控制、局限程度的情況。它的計算結果即RAV得分，可代表目標系統當前的安全狀況。
● 這種方法的評估報告均採用安全測試審計報告（STAR，Security TestAudit Report）範本。以這種格式書寫的報告同時適合被測單位的管理層和技術層閱讀，有助於他們共同理解測試目標、風險評估值（RAV）和每個階段的測試結果。
● 該方法定期更新。OSSTMM 會符合安全測試、法規和法規問題的新變化。
● OSSTMM 與行業法規、企業政策，以及政府法規相容。此外，官方認可的審計員都是直接從ISECOM（安全與開放式方法論研究協會）獲取的資格認證。
2.3.2 資訊系統安全評估框架
資訊系統安全評估框架（Information Systems SecurityAssessment Framework，ISSAF） （www.oissg. org/issaf）是另外一種開放原始程式碼的安全性測試和安全分析框架。為了解決安全評估工作的邏輯順序問題，該框架已分為若干個領域（domain）。不同領域評估目標系統的不同部分，而且可以根據實際情況對每個領域進行相應調整。把這一架構與日常業務的生命週期相結合，可以充分滿足企業安全測試的準確性、完整性、高效性的需求。ISSAF兼顧了安全測試的技術方面和管理方面。在技術方面，它有一整套關鍵的規則和程式，形成了一套完備的評估程式。在管理方面，它明確了在整個測試過程中應當遵循的管理要則和最佳實踐。應當注意，ISSAF主張安全評估是一個過程，而不是一次審計。審計框架應當分為計畫、評估、修復、評審以及維護階段，應當有更為完善的標準。然而ISSAF具有靈活和高效的特點，是審計工作各個階段的通用準則，可適用於所有企業結構。
這一框架的交付報告分為業務活動、安全措施、目標系統中可能存在的安全弱點的完整清單。其評估過程注重分析被測單位最容易被利用的關鍵漏洞，側重於以通過最短路徑儘快完成測試任務。
ISSAF 的技術評估基準十分全面，可用於測試各種技術和不同流程。不過，豐富的內容帶來了一大副作用，即要跟上評估領域的技術變化速度，這一框架就需要頻繁更新。相對而言，OSSTMM受技術更新影響的幅度略小。即使審計人員使用不同的工具和全新的技術，他們遵循的方法論卻基本不變。雖然如此，但是ISSAF仍然號稱是由最新的安全工具、最佳實踐，以及補充安全評估計畫的管理理念所組成的廣泛框架。它也可以和OSSTMM或其他測試方法論一起使用，從而能夠兼有各種方法的優點。
主要特性與優勢
ISSAF的主要特性與優勢如下。
● ISSAF 主要測試當前安全控制措施中的嚴重漏洞，所以它在保障系統安全方面的意義重大。
● 它關注資訊安全範疇內的各個關鍵領域，涵蓋了風險評估、業務結構和管理、控制評估、服務管理、安全性原則的開發和常規的最佳實踐。
● ISSAF 滲透測試方法論評估網路、系統或應用程式的安全性。應用該框架可以無阻礙地把精力重點放在特定技術上，如路由器、交換機、防火牆、入侵偵測和防禦系統、存儲區域網路、虛擬私人網路絡、各種作業系統、Web 應用伺服器、資料庫等。
● 通過必要的控制和處理，它可以統一技術層和管理層這兩方面人員對安全測試的理解。
● 它可幫助管理人員理解當前邊界防禦體系的現有風險，並可指出可能影響業務完整性的安全弱點，從而幫助人們主動地減少風險。
可同時結合OSSTMM和ISSAF兩種理論評估企業環境的安全狀況。
2.3.3 開放式Web應用程式安全專案
開放式 Web應用程式安全專案（Open Web Application Security Project，OWASP）定期推出其top 10 project（ 排名前十位的安全隱患防護守則）以提高公共對應用安全的認知意識。這個專案公開了編寫安全程式所需遵循的各種原則和慣例。OWASP 的測試項目（https://www.owasp.org/index.php/owasp- Testing_Project）公佈了一套非常實用的安全測試指南。您應當仔細閱讀這部分內容，因為這個測試框架往往可以指導您的工作。
OWASP 的Top 10 Project 總結了各種攻擊向量，按照各種隱患可能在技術上和業務上造成的危害，對影響應用安全的風險進行分類和排名。在評估應用程式安全時，這些排名前十的安全風險揭露了普遍存在於各種技術和平臺的通用攻擊方法。它還闡述了測試、驗證和修補應用程式安全弱點的具體方法。儘管Top 10 Project揭示了安全領域的高風險問題，但是這10種風險也只是Web應用程式安全性問題的一部分而已。儘管如此，OWASP社區的很多指南仍然可以指導開發人員和安全審計人員有效地管理Web應用程式的安全。
● 測試指南：https://www.owasp.org/index.php/OWASP_Testing-Guide_v3 _Tab1e_of_Content。
● 開發人員指南：https://www.owasp.org/index.php/Guide。
● 代碼審查指南：https://www.owasp.org/index.php/Category: OWASP_Code_Review_Project。
OWASP的Top 10 Project每年都會更新。如需獲取詳細資訊，請訪問這個專案的官方網站https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project。
主要特性與優勢
OWASP的主要特性與優勢如下。
● OWASP 推出了Web應用程式的十大安全風險的測試方法。應用這些方法，可使應用程式避免出現常見的安全缺陷，免受常見攻擊的危害，進而鞏固了應用程式的保密性、完整性和可用性。
● OWASP 社區研發出大量安全工具，這些工具可輔助進行自動或手動的Web 應用程式測試。Kali Linux 收錄了其中較為著名的程式，如WebScarab、Wapiti、JBroFuzz和SQLiX等。
● 在網路基礎設施的安全評估方面，OWASP 測試指南為您提供了特定技術的評估細則。舉例來說，它的甲骨文（Oracle）的測試方法與 MySQL 的測試方法就各有針對性。該指南採用多種相互關聯的方法評估各種技術，有助於審計人員因地制宜地制定測試方法。
● 它鼓勵研發人員在研發週期的每個階段進行有計劃的安全測試。這能提高應用程式的健全性、安全性，並能減少程式中的錯誤。
● 它在業內的認可度和知名度屈指可數。若把排名前十位的安全隱患防護守則與其他Web應用程式安全評估標準結合使用，您可同時滿足一個以上的安全標準。
2.3.4 Web應用安全聯合威脅分類
只有徹底、嚴格的測試流程，才能發現應用程式的安全隱患，而這些測試流程完全可以納入軟體的開發生命週期。Web 應用安全聯合威脅分類（Web Application Security Consortium Threat Classification，WASC-TC）是這樣的一個評估Web 應用程式安全性的開放標準。與OWASP標準相似，它也從攻擊和弱點兩方面討論安全問題，但這一標準以更為深入的方式解決安全隱患。要識別、驗證應用程式所面臨的各種威脅，就要遵循標準化的工作流程。WASC-TC可以迅速適用於各種技術環境，有著顯著的易用性。整體上說，它能夠幫助開發人員和安全審計人員以不同的視圖瞭解Web應用程式面臨的安全威脅。
● 枚舉視圖：枚舉視圖是分析Web 應用程式攻擊手段和相應安全弱點的基礎。它從定義、類型和多種程式設計平臺的實例這幾個角度，詳細討論了每種攻擊手段和每個安全弱點。另外，所涉及的安全弱點和攻擊手段都被分配了唯一的識別編號，以便於人們引用。目前，這個視圖裡總共有49個WASC-ID號碼（1～49）。這些編號並不代表相應條目的危害程度，僅僅是為了方便引用而分配的編號。
● 開發視圖：開發視圖關聯分析外部的攻擊和程式內部的安全弱點，將開發人員的視野轉向程式自身的漏洞。這一分析適用于開發週期的三個階段，即設計、實現（程式設計）、部署階段。如果在明確應用程式的需求時沒有充分考慮安全方面要求，就會在研發週期的初期階段引發漏洞，形成設計階段的安全弱點。不安全的程式設計規則或不當的慣例產生會造成實現階段的安全弱點。無論在應用程式、Web 伺服器或是其他外部系統的配置過程中哪個部分出現差錯，最終都會導致部屬階段的安全弱點。可見，這個視圖以最佳安全實踐為藍本，提出了將安全保障措施融入到日常的研發生命週期的具體方法。
● 交叉引用視圖：這個視圖關聯地分析了多種Web 應用安全標準。通過對該視圖的引用，審計人員和開發團隊能夠把當前所使用的標準中的術語（標準條款）與其他標準的相應內容進行對照分析。如此一來，只需要較少的開銷，就可以讓一個項目同時符合多種不同的安全標準。因為不同的應用程式安全標準會從不同的角度評估應用程式的安全性，所以它們衡量同一的風險的評估指標也不盡相同。因此，要對不同安全標準進行差異性分析，才能夠正確地計算安全風險及其嚴重程度。當前WASC-TC 中的攻擊方法和薄弱環節，可以映射到OWASP 的Top 10 Project、Mitre通用缺陷列表（Common Weakness Enumeration，CWE）、Mitre 通用攻擊模式清單和分類（Common Attack Pattern Enumeration and Classification，CAPEC）、SANS-CWE 排名前 25 的軟體高危錯誤清單（SANS-CWE Top 25 list）。
Mitre's CWE 的官方網站是https://cwe.mitre.org/。
Mitre's CAPEC 的官方網站是http://capec.mitre.org/。
SANS-CWE的排名前25的軟體高危錯誤清單的發佈網站是http://www.sans.org/top25-software-errors/。
如需詳細瞭解 WASC-TC 及其評論，請訪問官方網站：http://projects.webappsec.org/Threat-Classification。
主要特性與優勢
WASC－TC的主要特性與優勢如下。
● WASC－TC 圍繞常見攻擊和常規弱點這一中心，深入討論了 Web 應用程式運營系統的安全評估方法。
● 無論何種Web 應用程式平臺，都可使用Kali Linux 的工具集驗證、測試WASC－TC提出的常見攻擊和常規弱點。
● 它提出了三種不同視圖，即枚舉視圖、開發視圖和交叉引用視圖。枚舉視圖起到了基礎資料庫的作用，它列舉了在 Web 應用中所有可能被發現的攻擊方法和安全弱點。開發視圖將這些攻擊方法和安全弱點進行關聯分析，整理成一系列漏洞，並根據它們在開發過程中的出現階段進行分類。而開發階段又可分為設計階段、實現階段和部署階段。WASC-TC 標準的交叉引用視圖用於對照、引用其他的應用程式安全標準。
● WASC-TC 標準已經得到了業界的廣泛認可。在許多開源和商業解決方案裡，特別是漏洞評估和管控產品中，都能看到WASC-TC的身影。
● WASC-TC 也可以和其他著名的應用安全標準相容，例如OWASP 和SANS-CWE。
2.4 滲透測試執行標準
滲透測試執行標準（Penetration Testing Execution Standard，PTES）的先驅都是滲透測試行業的精英。這個標準由滲透測試7個階段的標準組成，可在任意環境中進行富有成果的滲透測試。它的官方網站詳細介紹了具體測試方法，有興趣的讀者可訪問 http://www. pentest-standard.org/index.php/Main_Page。
根據這一標準，標準的滲透測試可以分為下述7個階段：
● 事前互動；
● 情報收集；
● 威脅建模；
● 漏洞分析；
● 漏洞利用；
● 深度利用；
● 書面報告。
PTES 的官方網站詳細介紹了每個階段的思維導圖（mind maps）和組成步驟。這些內容有助於審計人員根據被測環境的測試要求，對PTES標準進行相應調整。只要在其官方網站上點擊思維導圖的構成節點，就可詳細查看該節點的各個組成步驟。
主要特性與優勢
PTES的主要特性與優勢如下。
● 它是非常全面的滲透測試框架，涵蓋了滲透測試的技術方面和其他重要的方面，如範圍蔓延（scope creep）、報告，以及滲透測試人員保護自身的方法。
● 它介紹了多數測試任務的具體方法，可指導您準確測試目標系統的安全狀態。
● 它彙聚了多名日行一“滲”的滲透測試專家的豐富經驗。
● 它包含了最常用的以及很罕見的相關技術。
● 它淺顯易懂，您可根據測試工作的需要對相應測試步驟進行調整。
2.5 通用滲透測試框架
Kali Linux 屬於通用型作業系統，它配備有多種安全評估工具和滲透測試工具。在沒有合適的測試理論指導的情況下冒然使用這些工具，可能會導致測試失敗，測試結果可能無法讓人滿意。因此，從技術管理的角度來看，遵循正規的測試框架對安全測試極為重要。
這一小節將通過黑盒測試的具體方法和白盒測試的通用測試方法介紹通用測試框架。它涵蓋了典型的審計測試工作和滲透測試工作會涉及到的各個階段。評估人員可以根據被測目標的具體情況對上述測試方法進行相應調整。這一方法論由一系列相關步驟所組成。要想成功完成安全評估項目，必須在測試的初始化階段、測試進行階段以及測試結束階段全面遵循這些步驟。這些步驟包括：
● 範圍界定；
● 資訊收集；
● 目標識別；
● 服務枚舉；
● 漏洞映射；
● 社會工程學；
● 漏洞利用；
● 提升許可權；
● 訪問維護；
● 文檔報告。
無論是進行白盒測試還是黑盒測試，選擇和使用測試步驟都是測試人員的責任。在測試開始前，測試人員需要根據目標系統的實際環境和已掌握的關於目標系統的情況，制定最佳的測試策略。下文將會介紹每一個測試階段，包括它們的簡要描述、定義和可能適用的應用程式。雖然這種通用測試方法論可以配合其他的方法論同時使用，但是它只是一種指導建議，而不是全能的滲透測試解決方案。
2.5.1 範圍界定
在開始技術性安全評估之前，務必要觀察、研究目標環境的被測範圍。同時還要瞭解，這個範圍牽扯到多少個單位，是單個單位還是多個單位會參與到安全評估的工作中來。在範圍界定階段，需要考慮的典型因素如下。
● 測試物件是什麼？
● 應當採取何種測試方法？
● 有哪些在測試過程中需要滿足的條件？
● 哪些因素可能會限制測試執行的過程？
● 需要多久才能完成測試？
● 此次測試應當達成什麼任務目標？
審計人員只有確切理解被評估系統所使用的技術，理解其基本功能，以及相關技術與網路之間的相互影響，才能成功達成滲透測試的目標。因此，無論是進行什麼類型的安全評估專案，審計人員的知識結構都將起著至關重要的作用。
2.5.2 資訊收集
在劃定了測試範圍之後，就需要進入資訊收集階段。在這個階段，滲透測試人員需要使用各種公開資源盡可能地獲取測試目標的相關資訊。他們從互聯網上搜集資訊的互聯網管道主要有：
● 論壇；
● 公告板；
● 新聞群組；
● 媒體文章；
● 博客；
● 社交網路；
● 其他商業或非商業性的網站。
此外，他們也可借助各種搜尋引擎中獲取相關資料，例如穀歌、雅虎、MSN必應、百度等。進一步說，審計人員可以使用Kali Linux 收錄的各種工具在測試目標的網路系統裡挖掘資訊。這些運用漏洞資料採擷技術的工具能夠收集可觀資訊，包括DNS伺服器、路由關係、whois資料庫、電子郵寄地址、電話號碼、個人資訊以及使用者帳戶。收集到的資訊越多，滲透測試成功的概率就越高。
2.5.3 目標識別
這個階段的主要任務是識別目標的網路狀態、作業系統和網路架構。該階段工作旨在完整地展現目標網路裡各種聯網設備或技術的完整關係，以幫助測試人員在接下來的工作裡枚舉目標網路的各種服務。Kali Linux 提供的一系列先進的網路工具，可以輕鬆探測到聯網主機，識別這些主機運行的作業系統，並根據每個設備在網路系統中的不同角色對它們進行歸類。這些工具通常採用了基於上層網路通訊協定的主動和被動的檢測技術。它們能夠通過不同的方式巧妙地利用各種協定獲取許多有用的資訊，比如作業系統指紋等。
2.5.4 服務枚舉
這一階段會根據前面各個階段的成果，進一步找出目標系統中所有開放的埠。一旦找到了所有開放的埠，就可以通過這些埠來列出目標系統上運行的服務。有很多掃描埠的技術，如全開（full-open）掃描、半開（half-open）掃描、隱蔽式（stealth）掃描等。這些技術都可用來檢測埠的開放情況，甚至可以掃描處於防火牆或者入侵偵測系統保護下的主機。主機上開放的埠都有相應的服務程式，對這些資訊進行深度分析之後，可進一步發掘目標網路基礎設施中可能存在的漏洞。因此，這個階段為其後的測試工作打下了基礎，有助於測試人員繼而發現各種網路設備上可能會造成嚴重危害的安全性漏洞。Kali Linux收錄的部分自動化工具可以輔助審計人員完成這一階段的目標。
2.5.5 漏洞映射
至此為止，我們已經充分收集了目標網路的各種資訊。接下來，我們就可以根據已經發現的開放埠和服務程式，查找、分析目標系統中存在的漏洞。Kali Linux 系統中提供的一系列自動化的網路和應用漏洞評估工具可以擔任完成這個階段的任務。當然，人工（手動）完成這些任務未嘗不可，只是人工作業極為耗時，而且需要有關人員擁有專家級的知識。但是，如果能夠將自動和手動這兩種不同的測試方法結合起來，審計人員對目標系統的認知就會更為清晰、透徹，並能夠仔細地檢查任何已知和未知的漏洞。否則，被遺漏的漏洞將會一直殘留在目標網路系統裡。
2.5.6 社會工程學
如果目標網路沒有直接的入口，欺騙的藝術將起到抛磚引玉的重要作用。對目標群組織中的人員進行定向攻擊，很有可能説明我們找到滲透目標系統的入口。例如，誘使用戶運行會安裝後門的惡意程式，就可能為審計人員的滲透工作形成突破。社會工程學滲透分為多種不同實現形式。偽裝成網路系統管理員，通過電話要求使用者提供自己的帳戶資訊；發送釣魚郵件來劫持用戶的銀行帳戶；甚至是誘使某人出現在某個地點——這些都屬於社會工程學攻擊。在社會工程學中，達成同一既定目標的實現方式應有盡有。需要注意的是，在對目標實施欺騙以達成滲透目標之前，多數情況下需要長時間研究目標人員的心理。另外，在開展這個階段的工作之前，您需要事先研究國內的法律是否有關於社會工程學的相關條款。
2.5.7 漏洞利用
在仔細檢查和發現目標系統中的漏洞之後，就可以使用已有的漏洞利用程式對目標系統進行滲透。某些情況下不得不對漏洞利用程式（exploit）進行額外的研究和修改，否則它可能就無法正常工作。雖然這聽起來就很麻煩，但是先進的漏洞利用（修改）工具可使這項工作容易得多，而且Kali Linux 已經收錄了這種工具。此外，審計人員可以把用戶端漏洞利用程式和社會工程學進行結合，進而控制目標系統。這個階段的主要任務是控制目標系統。整個流程可以分為3步，涉及攻擊前、攻擊、攻擊後的相關行動。
2.5.8 提升許可權
獲取目標系統的控制權是滲透成功的標誌。接下來，審計人員就可以依據其所擁有的存取權限，在被測系統中自由發揮。審計人員也可以使用適用於目標系統的本地漏洞來提升自己的許可權。只要他們能夠在目標系統上運行提權漏洞利用程式，就可以獲得主機上的超級使用者許可權或者系統級許可權。審計人員還可以以該主機為跳板，進一步攻擊區域網路。根據之前對滲透範圍的界定，審計人員接下來會開展的攻擊可能是受限制的，也可能是不受限的。而後，他們很有可能以各種方式獲得與被控制系統有關的更多資訊。具體的說，他們可能使用嗅探手段截獲網路資料包，破解各種服務的密碼，在區域網路中使用網路欺騙手段。所以說，提升許可權的最終目的是獲得目標系統的最高存取權限。
2.5.9 訪問維護
多數情況下，審計人員需要在一段時間內維護他們對目標系統的存取權限。例如，在演示越權訪問目標系統的時候，安裝後門將節省重新滲透目標系統所耗費的大量時間。這些情況下，訪問維護將節約獲取目標系統存取權限所需要的時間、花費和資源。審計人員可以通過一些秘密的通信隧道，在既定時間內維持對目標的存取權限。這些隧道往往基於特定協定、代理或者點對點通信方法的後門程式。這種對系統的存取方法可以清楚地展示，入侵人員在目標系統實施攻擊時隱匿行蹤的具體方法。
2.5.10 文檔報告
在滲透測試的最後一個環節裡，審計人員要記錄、報告並現場演示那些已經識別、驗證和利用了的安全性漏洞。被測單位的管理和技術團隊會檢查滲透時使用的方法，並會根據這些文檔修補所有存在的安全性漏洞。所以從道德角度來看，文檔報告的工作十分重要。為了幫助慣例人員和技術人員共同理解、分析當前IT基礎架構中的薄弱環節，可能需要給不同的部門撰寫不同措辭的書面報告。此外，這些報告還可以用來獲取和比較滲透測試前後目標系統的完整性。
2.6 道德準則
專業的、道德的、經過授權的安全測試服務，離不開由事先約定的規則所組成的安全測試道德準則。這些準則約定了安全測試服務的服務方式、安全實施的測試方法、合同和談判所約定的法律條款、測試的範圍、測試的準備、測試的流程，以及報告結構的一致性。要顧全上述因素，就要仔細地考察、設計在整個測試過程中都要遵循的正規的操作方法和相關流程。下面將介紹一些常見的到的準則。
● 審計人員不得在和客戶達成正式協定之前對目標系統進行任何形式的滲透測試。這種不道德的行銷方法有可能破壞客戶的正常業務。在某些國家或地區，這種行為甚至可能是違法行為。
● 在測試過程中，在沒有得到客戶明確許可的情況下，測試人員不得進行超出測試範圍越過已約定範疇的安全測試。
● 具有法律效力的正式合同可幫助測試人員避免承擔不必要的法律責任。正式合同將會約定哪些滲透行為屬於免責範圍。這份合同必須清楚地說明測試的條款和條件、緊急聯繫資訊、工作任務聲明以及任何明顯的利益衝突。
● 測試人員應當遵守測試計畫所明確的安全評估的時間期限。滲透測試的時間應當避開正常生產業務的時間段，以避免造成相互影響。
● 測試人員應當遵循在測試流程裡約定的必要步驟。這些規則以技術和管理不同角度，通過內部環境和相關人員來制約測試的流程。
● 在範圍界定階段，應當在合同書裡明確說明安全評估業務涉及到的所有實體，以及他們在安全評估的過程中受到哪些制約。
● 測試結果和書面報告必須清晰，其順序必須一致。報告中提及的所有已知的和未知的漏洞，必須以安全保密的方式遞交給有權查看報告的相關責任人。
2.7 本章總結
本章詳細介紹了多種滲透測試方法論，以及滲透測試的基本術語、相關類型，還有這些術語和業內其他術語之間的區別。本章的重點內容如下。
● 滲透測試可分為黑盒測試和白盒測試。黑盒測試也稱為外部測試，在黑盒測試中，審計人員事先不瞭解目標系統的內部結構或任何技術。白盒測試也叫內部測試，在白盒測試中，審計人員瞭解目標系統的全部細節。結合黑盒測試和白盒測試的測試類型，稱做灰盒測試。
● 脆弱性評估和滲透測試最基本的不同點在於：脆弱性評估旨在找出目標系統中存在的安全性漏洞，並不會去衡量這些漏洞可能造成的相應危害；而滲透測試會進一步利用這些漏洞，發起實質性攻擊以評估它們可能造成的安全問題。
● 雖然業內有很多安全測試方面的方法論，但是在評測網路系統或應用程式安全性方面，只有極少數的方法論才能夠具有階段性的循序漸進的指導意義。本章介紹了5個非常有名的開源安全評估方法論，突出了它們的技術功能、主要特徵和優勢。這5 個方法論分別是開源安全測試方法論（ OSSTMM ）、資訊系統安全評估框架（ISSAF）、開放式Web應用程式安全專案（OWASP），滲透測試執行標準（PTES）以及Web 應用安全聯合威脅分類 （WASC-TC）。
● 本章還介紹了一個簡單的結構化的通用測試方法論。它由安全測試行業標準方法歸納而來，分為多個標準化測試階段。這些階段分為：範圍界定、資訊收集、目標識別、服務枚舉、漏洞映射、社會工程學、漏洞利用、提升許可權、訪問維護、文檔報告。
● 最後，本章討論了在整個安全評估過程中必須遵守的滲透測試道德準則。在安全評估的各個階段落實有關道德準則，可以切實保障審計人員和商業實體雙方的各自利益。
在接到一個滲透測試任務時，如何從客戶那裡獲取相關資訊，又如何對資訊進行管理?請參見下一章。


```
